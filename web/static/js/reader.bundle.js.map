{
  "version": 3,
  "sources": ["../ts/core/model.ts", "../ts/core/invariant.ts", "../ts/domain/chess/fen.ts", "../ts/domain/chess/analysisTree.ts", "../ts/domain/chess/san.ts", "../ts/domain/pdf/bbox.ts", "../ts/domain/pdf/page.ts", "../ts/core/selectors.ts", "../ts/core/update.ts", "../ts/ui/dom.ts", "../ts/ui/adapters/overlay.ts", "../ts/ui/render.ts", "../ts/ui/bindings.ts", "../ts/ui/palette.ts", "../ts/ui/selection.ts", "../ts/core/result.ts", "../ts/ports/api.ts", "../ts/ports/chessnut.ts", "../ts/ports/pdfjs.ts", "../ts/ports/stockfish.ts", "../ts/ui/adapters/chessboard.ts", "../ts/core/runtime.ts", "../ts/main.ts"],
  "sourcesContent": ["import type { FenFull, FenPlacement, PlacementKey } from \"../domain/chess/fen\";\nimport type { San } from \"../domain/chess/san\";\nimport type { AnalysisTree, NodePath } from \"../domain/chess/analysisTree\";\nimport type { CssBBox, PdfBBox } from \"../domain/pdf/bbox\";\n\nexport type Brand<T, B extends string> = T & { readonly __brand: B };\n\nexport type PdfId = Brand<string, \"PdfId\">;\nexport type ContentHash = Brand<string, \"ContentHash\">;\nexport type GameId = Brand<string, \"GameId\">;\n\nexport type PageNum = Brand<number, \"PageNum1\">;\nexport type PageIndex = Brand<number, \"PageIndex0\">;\n\nexport type CssPx = Brand<number, \"CssPx\">;\nexport type PdfPx = Brand<number, \"PdfPx\">;\nexport type RetinaPx = Brand<number, \"RetinaPx\">;\n\nexport const asPdfId = (value: string): PdfId => value as PdfId;\nexport const asContentHash = (value: string): ContentHash => value as ContentHash;\nexport const asGameId = (value: string): GameId => value as GameId;\nexport const asPageNum = (value: number): PageNum => value as PageNum;\nexport const asPageIndex = (value: number): PageIndex => value as PageIndex;\nexport const asCssPx = (value: number): CssPx => value as CssPx;\nexport const asPdfPx = (value: number): PdfPx => value as PdfPx;\nexport const asRetinaPx = (value: number): RetinaPx => value as RetinaPx;\n\nexport type TextSelectMode = \"ocr\" | \"overlay\";\nexport type ReachMode = \"manual\" | \"otb\";\n\nexport type EngineState = Readonly<{\n  running: boolean;\n  evalText: string;\n  pv: string;\n}>;\n\nexport type BoardStatus = Readonly<{\n  available: boolean;\n  connected: boolean;\n}>;\n\nexport type Game = Readonly<{\n  id: GameId;\n  page: PageNum;\n  bbox: PdfBBox;\n  displayBbox?: CssBBox;\n  fen: FenPlacement;\n  confidence: number;\n  pending: boolean;\n}>;\n\nexport type ContinuationLink = Readonly<{\n  analysisId: GameId;\n  nodePath: NodePath;\n}>;\n\nexport type ContinuationPrompt = Readonly<{\n  posId: GameId;\n  analysisId: GameId;\n  nodePath: NodePath;\n  sourcePage: PageNum;\n}>;\n\nexport type PendingGame = Readonly<{\n  gameId: GameId;\n  targetFen: FenPlacement;\n  page: PageNum;\n  bbox: PdfBBox;\n  confidence: number;\n}>;\n\nexport type ReachSession = Readonly<{\n  targetFen: FenPlacement;\n  startFen: FenFull;\n  currentFen: FenFull;\n  baseAnalysisId: GameId | null;\n  gameId: GameId;\n  moves: ReadonlyArray<San>;\n  mode: ReachMode | null;\n  turn: \"w\" | \"b\";\n}>;\n\nexport type Workflow =\n  | { tag: \"NO_PDF\" }\n  | { tag: \"VIEWING\"; activeGameId: GameId | null }\n  | { tag: \"PENDING_CONFIRM\"; pending: PendingGame }\n  | {\n      tag: \"MATCH_EXISTING\";\n      pending: PendingGame;\n      candidates: ReadonlyArray<GameId>;\n      selected: GameId | null;\n    }\n  | { tag: \"REACHING\"; session: ReachSession }\n  | { tag: \"ANALYSIS\"; activeGameId: GameId; cursor: NodePath };\n\nexport type PdfState = Readonly<{\n  id: PdfId | null;\n  contentHash: ContentHash | null;\n  filename: string | null;\n  currentPage: PageNum;\n  totalPages: number;\n  scale: number;\n  initialScaleSet: boolean;\n}>;\n\nexport type DiagramPage = Readonly<{\n  page: PageNum;\n  diagrams: ReadonlyArray<PdfBBox>;\n}>;\n\nexport type UiState = Readonly<{\n  statusMessage: string;\n  textSelectMode: TextSelectMode | null;\n  textOverlayText: string;\n  textOverlayVisible: boolean;\n  ocrStatus: string;\n  openingInputVisible: boolean;\n  openingMovesInput: string;\n  selectedPiece: string | null;\n}>;\n\nexport type Model = Readonly<{\n  pdf: PdfState;\n  diagrams: DiagramPage | null;\n  games: ReadonlyArray<Game>;\n  analyses: Readonly<Record<GameId, AnalysisTree>>;\n  continuations: Readonly<Record<GameId, ContinuationLink>>;\n  continuationPrompt: ContinuationPrompt | null;\n  workflow: Workflow;\n  currentNode: NodePath | null;\n  engine: EngineState;\n  boardStatus: BoardStatus;\n  recognitionInProgress: number | null;  // Index of diagram being recognized, null if none\n  isDirty: boolean;\n  ui: UiState;\n  placementKeyIndex: Readonly<Record<PlacementKey, GameId>>;\n}>;\n\nexport type Study = Readonly<{\n  games: ReadonlyArray<Game>;\n  analyses: Readonly<Record<GameId, AnalysisTree>>;\n  continuations: Readonly<Record<GameId, ContinuationLink>>;\n}>;\n\nexport const initialModel: Model = {\n  pdf: {\n    id: null,\n    contentHash: null,\n    filename: null,\n    currentPage: 1 as PageNum,\n    totalPages: 0,\n    scale: 1,\n    initialScaleSet: false,\n  },\n  diagrams: null,\n  games: [],\n  analyses: {},\n  continuations: {},\n  continuationPrompt: null,\n  workflow: { tag: \"NO_PDF\" },\n  currentNode: null,\n  engine: {\n    running: false,\n    evalText: \"-\",\n    pv: \"-\",\n  },\n  boardStatus: {\n    available: false,\n    connected: false,\n  },\n  recognitionInProgress: null,\n  isDirty: false,\n  ui: {\n    statusMessage: \"Ready\",\n    textSelectMode: null,\n    textOverlayText: \"\",\n    textOverlayVisible: false,\n    ocrStatus: \"\",\n    openingInputVisible: false,\n    openingMovesInput: \"\",\n    selectedPiece: null,\n  },\n  placementKeyIndex: {},\n};\n", "export const assertNever = (value: never): never => {\n  throw new Error(`Unexpected value: ${String(value)}`);\n};\n\nexport const invariant = (condition: boolean, message: string): asserts condition => {\n  if (!condition) {\n    throw new Error(message);\n  }\n};\n", "import type { Brand } from \"../../core/model\";\nimport type { FenPiece, Square } from \"./san\";\n\nexport type FenPlacement = Brand<string, \"FenPlacement\">;\nexport type FenFull = Brand<string, \"FenFull\">;\nexport type PlacementKey = Brand<string, \"PlacementKey\">;\n\nexport type FenError =\n  | { tag: \"EMPTY\" }\n  | { tag: \"INVALID_RANKS\"; detail: string }\n  | { tag: \"INVALID_ROW\"; detail: string };\n\nexport type PlacementMap = Readonly<Record<Square, FenPiece>>;\n\nconst files: ReadonlyArray<string> = [\"a\", \"b\", \"c\", \"d\", \"e\", \"f\", \"g\", \"h\"];\n\nexport const asFenPlacement = (value: string): FenPlacement => value as FenPlacement;\nexport const asFenFull = (value: string): FenFull => value as FenFull;\n\nexport const placementKey = (placement: FenPlacement): PlacementKey =>\n  placement as PlacementKey;\n\nexport const extractPlacement = (fen: FenFull | FenPlacement | string): FenPlacement =>\n  asFenPlacement(fen.split(\" \")[0] ?? \"\");\n\nexport const toFullFen = (placement: FenPlacement, turn: \"w\" | \"b\"): FenFull =>\n  asFenFull(`${placement} ${turn} KQkq - 0 1`);\n\nexport const fenTurn = (fen: FenFull | string): \"w\" | \"b\" => {\n  const raw = fen.split(\" \")[1];\n  return raw === \"b\" ? \"b\" : \"w\";\n};\n\nexport const parseFenPlacement = (raw: string): FenPlacement | FenError => {\n  if (!raw || raw.trim().length === 0) {\n    return { tag: \"EMPTY\" };\n  }\n  const placement = raw.split(\" \")[0] ?? \"\";\n  const ranks = placement.split(\"/\");\n  if (ranks.length !== 8) {\n    return { tag: \"INVALID_RANKS\", detail: placement };\n  }\n  for (const rank of ranks) {\n    let fileCount = 0;\n    for (const char of rank) {\n      if (char >= \"1\" && char <= \"8\") {\n        fileCount += Number(char);\n      } else if (/[prnbqkPRNBQK]/.test(char)) {\n        fileCount += 1;\n      } else {\n        return { tag: \"INVALID_ROW\", detail: rank };\n      }\n    }\n    if (fileCount !== 8) {\n      return { tag: \"INVALID_ROW\", detail: rank };\n    }\n  }\n  return asFenPlacement(placement);\n};\n\nexport const fenToPlacementMap = (fen: FenFull | FenPlacement): PlacementMap => {\n  const placement = extractPlacement(fen);\n  const map: Record<Square, FenPiece> = {} as Record<Square, FenPiece>;\n  const ranks = placement.split(\"/\");\n  for (let r = 0; r < 8; r += 1) {\n    const rank = 8 - r;\n    let file = 0;\n    for (const char of ranks[r] ?? \"\") {\n      if (char >= \"1\" && char <= \"8\") {\n        file += Number(char);\n      } else {\n        const square = `${files[file]}${rank}` as Square;\n        map[square] = char as FenPiece;\n        file += 1;\n      }\n    }\n  }\n  return map;\n};\n\nexport const placementsEqual = (map1: PlacementMap, map2: PlacementMap): boolean => {\n  const keys1 = Object.keys(map1).sort();\n  const keys2 = Object.keys(map2).sort();\n  if (keys1.length !== keys2.length) return false;\n  for (let i = 0; i < keys1.length; i += 1) {\n    const key = keys1[i] as Square;\n    if (key !== keys2[i]) return false;\n    if (map1[key] !== map2[key]) return false;\n  }\n  return true;\n};\n", "import type { FenFull } from \"./fen\";\nimport type { San } from \"./san\";\n\nexport type NodePath = ReadonlyArray<San>;\n\nexport type AnalysisNode = Readonly<{\n  fen: FenFull;\n  san: San | null;\n  comment: string;\n  children: ReadonlyArray<AnalysisNode>;\n}>;\n\nexport type AnalysisTree = Readonly<{\n  startFen: FenFull;\n  turn: \"w\" | \"b\";\n  root: AnalysisNode;\n}>;\n\nexport type AnalysisNodeJson = {\n  fen: string;\n  san: string | null;\n  comment?: string;\n  children: AnalysisNodeJson[];\n};\n\nexport type AnalysisTreeJson = {\n  startFen: string;\n  turn: \"w\" | \"b\";\n  tree: AnalysisNodeJson;\n};\n\nexport const createAnalysisTree = (startFen: FenFull, turn: \"w\" | \"b\"): AnalysisTree => ({\n  startFen,\n  turn,\n  root: {\n    fen: startFen,\n    san: null,\n    comment: \"\",\n    children: [],\n  },\n});\n\nexport const getNode = (root: AnalysisNode, path: NodePath): AnalysisNode | null => {\n  let current: AnalysisNode = root;\n  for (const san of path) {\n    const next = current.children.find((child) => child.san === san) ?? null;\n    if (!next) return null;\n    current = next;\n  }\n  return current;\n};\n\nconst updateNodeAtPath = (\n  node: AnalysisNode,\n  path: NodePath,\n  updater: (target: AnalysisNode) => AnalysisNode,\n): AnalysisNode => {\n  if (path.length === 0) {\n    return updater(node);\n  }\n  const [head, ...rest] = path;\n  const nextIndex = node.children.findIndex((child) => child.san === head);\n  if (nextIndex === -1) return node;\n  const updatedChild = updateNodeAtPath(node.children[nextIndex], rest, updater);\n  if (updatedChild === node.children[nextIndex]) return node;\n  const updatedChildren = node.children.map((child, idx) =>\n    idx === nextIndex ? updatedChild : child,\n  );\n  return { ...node, children: updatedChildren };\n};\n\nexport const makeMove = (\n  tree: AnalysisTree,\n  cursor: NodePath,\n  san: San,\n  fen: FenFull,\n): { tree: AnalysisTree; cursor: NodePath } => {\n  const existing = getNode(tree.root, [...cursor, san]);\n  if (existing) {\n    return { tree, cursor: [...cursor, san] };\n  }\n  const newNode: AnalysisNode = {\n    fen,\n    san,\n    comment: \"\",\n    children: [],\n  };\n  const nextRoot = updateNodeAtPath(tree.root, cursor, (node) => ({\n    ...node,\n    children: [...node.children, newNode],\n  }));\n  return { tree: { ...tree, root: nextRoot }, cursor: [...cursor, san] };\n};\n\nexport const goBack = (cursor: NodePath): NodePath | null =>\n  cursor.length === 0 ? null : cursor.slice(0, -1);\n\nexport const goForward = (tree: AnalysisTree, cursor: NodePath): NodePath | null => {\n  const node = getNode(tree.root, cursor);\n  if (!node || node.children.length === 0) return null;\n  const nextSan = node.children[0].san;\n  if (!nextSan) return null;\n  return [...cursor, nextSan];\n};\n\nexport const getNextVariation = (tree: AnalysisTree, cursor: NodePath): NodePath | null => {\n  if (cursor.length === 0) return null;\n  const parentPath = cursor.slice(0, -1);\n  const currentSan = cursor[cursor.length - 1];\n  const parent = getNode(tree.root, parentPath);\n  if (!parent) return null;\n  const idx = parent.children.findIndex((child) => child.san === currentSan);\n  if (idx === -1 || idx >= parent.children.length - 1) return null;\n  const nextSan = parent.children[idx + 1].san;\n  if (!nextSan) return null;\n  return [...parentPath, nextSan];\n};\n\nexport const getPrevVariation = (tree: AnalysisTree, cursor: NodePath): NodePath | null => {\n  if (cursor.length === 0) return null;\n  const parentPath = cursor.slice(0, -1);\n  const currentSan = cursor[cursor.length - 1];\n  const parent = getNode(tree.root, parentPath);\n  if (!parent) return null;\n  const idx = parent.children.findIndex((child) => child.san === currentSan);\n  if (idx <= 0) return null;\n  const prevSan = parent.children[idx - 1].san;\n  if (!prevSan) return null;\n  return [...parentPath, prevSan];\n};\n\nexport const deleteVariation = (\n  tree: AnalysisTree,\n  cursor: NodePath,\n): { tree: AnalysisTree; cursor: NodePath; deleted: boolean } => {\n  if (cursor.length === 0) return { tree, cursor, deleted: false };\n  const parentPath = cursor.slice(0, -1);\n  const currentSan = cursor[cursor.length - 1];\n  const parent = getNode(tree.root, parentPath);\n  if (!parent) return { tree, cursor, deleted: false };\n  const nextChildren = parent.children.filter((child) => child.san !== currentSan);\n  if (nextChildren.length === parent.children.length) {\n    return { tree, cursor, deleted: false };\n  }\n  const nextRoot = updateNodeAtPath(tree.root, parentPath, (node) => ({\n    ...node,\n    children: nextChildren,\n  }));\n  const nextCursor =\n    nextChildren.length > 0 && nextChildren[0].san\n      ? [...parentPath, nextChildren[0].san as San]\n      : parentPath;\n  return { tree: { ...tree, root: nextRoot }, cursor: nextCursor, deleted: true };\n};\n\nexport const getMainLineLeaf = (\n  tree: AnalysisTree,\n): { node: AnalysisNode; path: NodePath } => {\n  let node = tree.root;\n  const path: San[] = [];\n  while (node.children.length > 0) {\n    const child = node.children[0];\n    if (!child.san) break;\n    path.push(child.san);\n    node = child;\n  }\n  return { node, path };\n};\n\nexport const getMainLineMoves = (tree: AnalysisTree): ReadonlyArray<San> =>\n  getMainLineLeaf(tree).path;\n\nconst renderNode = (\n  node: AnalysisNode,\n  moveNum: number,\n  isWhite: boolean,\n): string => {\n  let result = \"\";\n  if (node.san) {\n    result += isWhite ? `${moveNum}. ${node.san}` : node.san;\n  }\n  if (node.children.length > 0) {\n    const mainChild = node.children[0];\n    const nextIsWhite = !isWhite;\n    const nextMoveNum = isWhite ? moveNum : moveNum + 1;\n    if (result) result += \" \";\n    result += renderNode(mainChild, nextMoveNum, nextIsWhite);\n    for (let i = 1; i < node.children.length; i += 1) {\n      const variation = node.children[i];\n      result += \" (\";\n      if (!isWhite) {\n        result += `${moveNum}... `;\n      }\n      result += renderNode(variation, isWhite ? moveNum : moveNum + 1, !isWhite);\n      result += \")\";\n    }\n  }\n  return result;\n};\n\nexport const toPGN = (tree: AnalysisTree): string => {\n  const lines: string[] = [];\n  lines.push(`[FEN \"${tree.startFen}\"]`);\n  lines.push(\"\");\n  const fenParts = tree.startFen.split(\" \");\n  const startMoveNum = Number.parseInt(fenParts[5] ?? \"1\", 10);\n  const isWhiteToMove = (fenParts[1] ?? \"w\") === \"w\";\n  const pgn = renderNode(tree.root, startMoveNum, isWhiteToMove);\n  lines.push(pgn.trim() || \"*\");\n  return lines.join(\"\\n\");\n};\n\nconst serializeNode = (node: AnalysisNode): AnalysisNodeJson => ({\n  fen: node.fen,\n  san: node.san,\n  comment: node.comment,\n  children: node.children.map(serializeNode),\n});\n\nconst deserializeNode = (data: AnalysisNodeJson): AnalysisNode => ({\n  fen: data.fen as FenFull,\n  san: (data.san ?? null) as San | null,\n  comment: data.comment ?? \"\",\n  children: (data.children ?? []).map(deserializeNode),\n});\n\nexport const analysisTreeToJSON = (tree: AnalysisTree): AnalysisTreeJson => ({\n  startFen: tree.startFen,\n  turn: tree.turn,\n  tree: serializeNode(tree.root),\n});\n\nexport const analysisTreeFromJSON = (json: AnalysisTreeJson): AnalysisTree => ({\n  startFen: json.startFen as FenFull,\n  turn: json.turn,\n  root: deserializeNode(json.tree),\n});\n", "import type { Brand } from \"../../core/model\";\n\nexport type File = \"a\" | \"b\" | \"c\" | \"d\" | \"e\" | \"f\" | \"g\" | \"h\";\nexport type Rank = \"1\" | \"2\" | \"3\" | \"4\" | \"5\" | \"6\" | \"7\" | \"8\";\nexport type Square = `${File}${Rank}`;\n\nexport type PieceRole = \"K\" | \"Q\" | \"R\" | \"B\" | \"N\" | \"P\";\nexport type Side = \"w\" | \"b\";\nexport type Piece = `${Side}${PieceRole}`;\n\nexport type FenPiece = PieceRole | Lowercase<PieceRole>;\n\nexport type San = Brand<string, \"San\">;\n\nexport const asSan = (value: string): San => value as San;\n", "import type { CssPx, PdfPx, RetinaPx } from \"../../core/model\";\n\nexport type BBox<Unit> = Readonly<{\n  x: Unit;\n  y: Unit;\n  width: Unit;\n  height: Unit;\n}>;\n\nexport type CssBBox = BBox<CssPx>;\nexport type PdfBBox = BBox<PdfPx>;\nexport type RetinaBBox = BBox<RetinaPx>;\n\nexport const bbox = <Unit>(x: Unit, y: Unit, width: Unit, height: Unit): BBox<Unit> => ({\n  x,\n  y,\n  width,\n  height,\n});\n\nexport const pdfToRetinaBBox = (pdf: PdfBBox, scale: number): RetinaBBox =>\n  bbox(\n    (pdf.x as number * scale) as RetinaPx,\n    (pdf.y as number * scale) as RetinaPx,\n    (pdf.width as number * scale) as RetinaPx,\n    (pdf.height as number * scale) as RetinaPx,\n  );\n\nexport const retinaToCssBBox = (retina: RetinaBBox): CssBBox =>\n  bbox(\n    (retina.x as number / 2) as CssPx,\n    (retina.y as number / 2) as CssPx,\n    (retina.width as number / 2) as CssPx,\n    (retina.height as number / 2) as CssPx,\n  );\n\nexport const cssToRetinaBBox = (css: CssBBox): RetinaBBox =>\n  bbox(\n    (css.x as number * 2) as RetinaPx,\n    (css.y as number * 2) as RetinaPx,\n    (css.width as number * 2) as RetinaPx,\n    (css.height as number * 2) as RetinaPx,\n  );\n\nexport const pdfToCssBBox = (pdf: PdfBBox, scale: number): CssBBox =>\n  retinaToCssBBox(pdfToRetinaBBox(pdf, scale));\n\nexport const cssToPdfBBox = (css: CssBBox, scale: number): PdfBBox => {\n  const retina = cssToRetinaBBox(css);\n  return bbox(\n    ((retina.x as number) / scale) as PdfPx,\n    ((retina.y as number) / scale) as PdfPx,\n    ((retina.width as number) / scale) as PdfPx,\n    ((retina.height as number) / scale) as PdfPx,\n  );\n};\n", "import type { PageIndex, PageNum } from \"../../core/model\";\n\nexport const toPageIndex = (page: PageNum): PageIndex => ((page as number) - 1) as PageIndex;\nexport const toPageNum = (index: PageIndex): PageNum => ((index as number) + 1) as PageNum;\n\nexport const clampPage = (page: number, totalPages: number): PageNum =>\n  (Math.min(Math.max(page, 1), totalPages)) as PageNum;\n", "import type { Game, GameId, Model, PendingGame, Workflow } from \"./model\";\nimport type { AnalysisTree, NodePath } from \"../domain/chess/analysisTree\";\nimport { getNode } from \"../domain/chess/analysisTree\";\n\nexport const getActiveGameId = (workflow: Workflow): GameId | null => {\n  switch (workflow.tag) {\n    case \"VIEWING\":\n      return workflow.activeGameId;\n    case \"PENDING_CONFIRM\":\n      return workflow.pending.gameId;\n    case \"MATCH_EXISTING\":\n      return workflow.pending.gameId;\n    case \"REACHING\":\n      return workflow.session.gameId;\n    case \"ANALYSIS\":\n      return workflow.activeGameId;\n    case \"NO_PDF\":\n      return null;\n    default:\n      return null;\n  }\n};\n\nexport const getPendingGame = (workflow: Workflow): PendingGame | null => {\n  switch (workflow.tag) {\n    case \"PENDING_CONFIRM\":\n      return workflow.pending;\n    case \"MATCH_EXISTING\":\n      return workflow.pending;\n    default:\n      return null;\n  }\n};\n\nexport const getActiveGame = (model: Model): Game | null => {\n  const id = getActiveGameId(model.workflow);\n  if (!id) return null;\n  return model.games.find((game) => game.id === id) ?? null;\n};\n\nexport type AnalysisContext = Readonly<{\n  tree: AnalysisTree;\n  nodePath: NodePath;\n  analysisId: GameId;\n}>;\n\nexport const getAnalysisContext = (model: Model, gameId: GameId): AnalysisContext | null => {\n  const direct = model.analyses[gameId];\n  if (direct) {\n    return {\n      tree: direct,\n      nodePath: model.currentNode ?? [],\n      analysisId: gameId,\n    };\n  }\n  const link = model.continuations[gameId];\n  if (link && model.analyses[link.analysisId]) {\n    const cursorOverride =\n      model.workflow.tag === \"ANALYSIS\" && model.workflow.activeGameId === gameId && model.currentNode\n        ? model.currentNode\n        : null;\n    return {\n      tree: model.analyses[link.analysisId],\n      nodePath: cursorOverride ?? link.nodePath,\n      analysisId: link.analysisId,\n    };\n  }\n  return null;\n};\n\nexport const getAnalysisNodeFen = (model: Model, gameId: GameId): string | null => {\n  const ctx = getAnalysisContext(model, gameId);\n  if (!ctx) return null;\n  const node = getNode(ctx.tree.root, ctx.nodePath);\n  return node ? node.fen : null;\n};\n", "import type { Cmd } from \"./cmd\";\nimport type { Msg } from \"./msg\";\nimport type {\n  Game,\n  GameId,\n  Model,\n  PendingGame,\n  ReachSession,\n  Study,\n  Workflow,\n} from \"./model\";\nimport { initialModel } from \"./model\";\nimport { assertNever } from \"./invariant\";\nimport {\n  asFenPlacement,\n  asFenFull,\n  extractPlacement,\n  placementKey,\n  toFullFen,\n  fenTurn,\n} from \"../domain/chess/fen\";\nimport {\n  createAnalysisTree,\n  deleteVariation,\n  getMainLineLeaf,\n  getNextVariation,\n  getNode,\n  getPrevVariation,\n  goBack,\n  goForward,\n  makeMove,\n  toPGN,\n} from \"../domain/chess/analysisTree\";\nimport { asSan } from \"../domain/chess/san\";\nimport { cssToPdfBBox } from \"../domain/pdf/bbox\";\nimport { toPageIndex } from \"../domain/pdf/page\";\nimport { getActiveGameId, getAnalysisContext } from \"./selectors\";\n\ntype UpdateResult = readonly [Model, ReadonlyArray<Cmd>];\n\nconst noCmd: ReadonlyArray<Cmd> = [];\n\nconst withStatus = (model: Model, message: string): Model => ({\n  ...model,\n  ui: {\n    ...model.ui,\n    statusMessage: message,\n  },\n});\n\nconst buildPlacementIndex = (\n  games: ReadonlyArray<Game>,\n): Readonly<Record<string, GameId>> => {\n  const index: Record<string, GameId> = {};\n  games.forEach((game) => {\n    if (!game.pending) {\n      index[placementKey(game.fen)] = game.id;\n    }\n  });\n  return index;\n};\n\nconst updateGame = (\n  games: ReadonlyArray<Game>,\n  gameId: GameId,\n  updater: (game: Game) => Game,\n): ReadonlyArray<Game> => games.map((game) => (game.id === gameId ? updater(game) : game));\n\nconst findExistingByPlacement = (model: Model, placement: string): Game | null =>\n  model.games.find((game) => !game.pending && game.fen === placement) ?? null;\n\nconst getPendingFromWorkflow = (workflow: Workflow): PendingGame | null => {\n  switch (workflow.tag) {\n    case \"PENDING_CONFIRM\":\n      return workflow.pending;\n    case \"MATCH_EXISTING\":\n      return workflow.pending;\n    case \"REACHING\":\n      return null;\n    case \"NO_PDF\":\n    case \"VIEWING\":\n    case \"ANALYSIS\":\n      return null;\n    default:\n      return assertNever(workflow);\n  }\n};\n\nconst applyStudy = (model: Model, study: Study | null): Model => {\n  if (!study) {\n    return model;\n  }\n  const games = study.games;\n  return {\n    ...model,\n    games,\n    analyses: study.analyses,\n    continuations: study.continuations,\n    placementKeyIndex: buildPlacementIndex(games),\n  };\n};\n\nconst createReachSession = (\n  model: Model,\n  pending: PendingGame,\n  baseAnalysisId: GameId | null,\n): ReachSession => {\n  if (baseAnalysisId && model.analyses[baseAnalysisId]) {\n    const baseTree = model.analyses[baseAnalysisId];\n    const { node } = getMainLineLeaf(baseTree);\n    return {\n      targetFen: pending.targetFen,\n      startFen: node.fen,\n      currentFen: node.fen,\n      baseAnalysisId,\n      gameId: pending.gameId,\n      moves: [],\n      mode: null,\n      turn: fenTurn(node.fen),\n    };\n  }\n  const startFen = toFullFen(\n    asFenPlacement(\"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR\"),\n    \"w\",\n  );\n  return {\n    targetFen: pending.targetFen,\n    startFen,\n    currentFen: startFen,\n    baseAnalysisId: null,\n    gameId: pending.gameId,\n    moves: [],\n    mode: null,\n    turn: \"w\",\n  };\n};\n\nexport const update = (model: Model = initialModel, msg: Msg): UpdateResult => {\n  switch (msg.tag) {\n    case \"Status\":\n      return [withStatus(model, msg.message), noCmd];\n    case \"Error\":\n      return [withStatus(model, msg.message), noCmd];\n    case \"PdfFileSelected\":\n      return [\n        withStatus(model, `Checking ${msg.file.name}...`),\n        [{ tag: \"PDF_LOAD_FILE\", file: msg.file }],\n      ];\n    case \"PdfOpened\": {\n      const nextModel: Model = {\n        ...model,\n        pdf: {\n          id: msg.pdfId,\n          contentHash: msg.contentHash,\n          filename: msg.filename,\n          currentPage: 1 as Model[\"pdf\"][\"currentPage\"],\n          totalPages: msg.pages,\n          scale: 1,\n          initialScaleSet: false,\n        },\n        diagrams: null,\n        games: [],\n        analyses: {},\n        continuations: {},\n        continuationPrompt: null,\n        workflow: { tag: \"VIEWING\", activeGameId: null },\n        currentNode: null,\n        recognitionInProgress: null,\n        isDirty: false,\n        placementKeyIndex: {},\n        ui: initialModel.ui,\n      };\n      return [\n        withStatus(nextModel, `Loaded ${msg.filename}`),\n        [\n          { tag: \"STUDY_LOAD\", pdfId: msg.pdfId },\n          { tag: \"PDF_RENDER_PAGE\", page: 1 as Model[\"pdf\"][\"currentPage\"], scale: 1 },\n          { tag: \"BOARD_STATUS_POLL_START\", everyMs: 5000 },\n        ],\n      ];\n    }\n    case \"PdfClosed\":\n      return [initialModel, noCmd];\n    case \"PageRequested\": {\n      const nextModel = {\n        ...model,\n        pdf: {\n          ...model.pdf,\n          currentPage: msg.page,\n        },\n      };\n      return [nextModel, [{ tag: \"PDF_RENDER_PAGE\", page: msg.page, scale: model.pdf.scale }]];\n    }\n    case \"PageRendered\": {\n      const nextModel = {\n        ...model,\n        pdf: {\n          ...model.pdf,\n          currentPage: msg.page,\n          scale: msg.scale,\n          initialScaleSet: msg.initialScaleSet,\n        },\n      };\n      if (!model.pdf.id) {\n        return [nextModel, noCmd];\n      }\n      return [\n        nextModel,\n        [\n          {\n            tag: \"API_DETECT_DIAGRAMS\",\n            pdfId: model.pdf.id,\n            page: toPageIndex(msg.page),\n          },\n        ],\n      ];\n    }\n    case \"ZoomChanged\": {\n      const nextModel = {\n        ...model,\n        pdf: {\n          ...model.pdf,\n          scale: msg.scale,\n          initialScaleSet: true,\n        },\n      };\n      return [\n        nextModel,\n        [{ tag: \"PDF_RENDER_PAGE\", page: model.pdf.currentPage, scale: msg.scale }],\n      ];\n    }\n    case \"DiagramsDetected\": {\n      const nextModel = {\n        ...model,\n        diagrams: { page: msg.page, diagrams: msg.diagrams },\n      };\n      return [withStatus(nextModel, `Found ${msg.diagrams.length} potential diagrams`), noCmd];\n    }\n    case \"DiagramActivated\":\n      return [\n        {\n          ...model,\n          workflow:\n            msg.gameId === null\n              ? { tag: \"VIEWING\", activeGameId: null }\n              : { tag: \"VIEWING\", activeGameId: msg.gameId },\n        },\n        noCmd,\n      ];\n    case \"DeleteGame\": {\n      const filtered = model.games.filter((game) => game.id !== msg.gameId);\n      const continuations = Object.fromEntries(\n        Object.entries(model.continuations).filter(([key, link]) => {\n          if (key === msg.gameId) return false;\n          return link.analysisId !== msg.gameId;\n        }),\n      );\n      const analyses = { ...model.analyses };\n      delete analyses[msg.gameId];\n      const activeId = getActiveGameId(model.workflow);\n      const nextWorkflow =\n        activeId === msg.gameId ? { tag: \"VIEWING\", activeGameId: null as GameId | null } : model.workflow;\n      const nextModel = {\n        ...model,\n        games: filtered,\n        analyses,\n        continuations,\n        placementKeyIndex: buildPlacementIndex(filtered),\n        workflow: nextWorkflow,\n      };\n      return [withStatus(nextModel, \"Deleted game\"), [{ tag: \"SCHEDULE_SAVE\", delayMs: 2000 }]];\n    }\n    case \"DiagramClicked\": {\n      console.log(\"[DEBUG] DiagramClicked received:\", msg);\n      console.log(\"[DEBUG] model.pdf.id:\", model.pdf.id);\n      console.log(\"[DEBUG] model.recognitionInProgress:\", model.recognitionInProgress);\n      if (!model.pdf.id) {\n        return [withStatus(model, \"No PDF loaded\"), noCmd];\n      }\n      if (model.recognitionInProgress !== null) {\n        return [withStatus(model, \"Recognition already in progress...\"), noCmd];\n      }\n      const pdfBBox = cssToPdfBBox(msg.bbox, model.pdf.scale);\n      const nextModel = {\n        ...model,\n        recognitionInProgress: msg.diagramIndex,\n      };\n      return [\n        withStatus(nextModel, \"Recognizing position...\"),\n        [\n          {\n            tag: \"API_RECOGNIZE_REGION\",\n            pdfId: model.pdf.id,\n            page: toPageIndex(msg.page),\n            bbox: pdfBBox,\n          },\n        ],\n      ];\n    }\n    case \"DiagramResized\":\n      return [model, noCmd];\n    case \"Recognized\": {\n      const existing = findExistingByPlacement(model, msg.placement);\n      if (existing) {\n        const nextModel = {\n          ...model,\n          recognitionInProgress: null,\n          workflow: { tag: \"VIEWING\", activeGameId: existing.id },\n        };\n        return [\n          withStatus(nextModel, `Game already saved (Page ${(existing.page as number) ?? \"?\"})`),\n          [{ tag: \"CHESSNUT_SET_FEN\", fen: msg.placement, force: true }],\n        ];\n      }\n      const pending: PendingGame = {\n        gameId: msg.gameId,\n        targetFen: msg.placement,\n        page: msg.page,\n        bbox: msg.bbox,\n        confidence: msg.confidence,\n      };\n      const newGame: Game = {\n        id: msg.gameId,\n        page: msg.page,\n        bbox: msg.bbox,\n        fen: msg.placement,\n        confidence: msg.confidence,\n        pending: true,\n      };\n      const games = [...model.games, newGame];\n      const nextModel = {\n        ...model,\n        recognitionInProgress: null,\n        games,\n        placementKeyIndex: buildPlacementIndex(games),\n        workflow: { tag: \"PENDING_CONFIRM\", pending },\n      };\n      return [\n        withStatus(nextModel, \"Confirm pieces, then choose how to continue\"),\n        [{ tag: \"CHESSNUT_SET_FEN\", fen: msg.placement, force: true }],\n      ];\n    }\n    case \"RecognitionFailed\":\n      return [\n        withStatus(\n          { ...model, recognitionInProgress: false },\n          `Recognition error: ${msg.message}`,\n        ),\n        noCmd,\n      ];\n    case \"ConfirmPieces\":\n      return [model, [{ tag: \"CHESSBOARD_READ_PREVIEW\" }]];\n    case \"PiecesConfirmed\": {\n      const pending = getPendingFromWorkflow(model.workflow);\n      if (!pending) {\n        return [withStatus(model, \"No pending game to confirm\"), noCmd];\n      }\n      const updatedGames = updateGame(model.games, pending.gameId, (game) => ({\n        ...game,\n        fen: msg.placement,\n      }));\n      const analyzedCandidates = Object.keys(model.analyses) as GameId[];\n      const nextModel = {\n        ...model,\n        games: updatedGames,\n        placementKeyIndex: buildPlacementIndex(updatedGames),\n        workflow: {\n          tag: \"MATCH_EXISTING\",\n          pending: { ...pending, targetFen: msg.placement },\n          candidates: analyzedCandidates,\n          selected: analyzedCandidates[0] ?? null,\n        },\n        isDirty: true,\n      };\n      return [nextModel, [{ tag: \"SCHEDULE_SAVE\", delayMs: 2000 }]];\n    }\n    case \"EditPieces\":\n      return [withStatus(model, \"Edit pieces using the palette, then confirm\"), noCmd];\n    case \"SelectCandidate\":\n    case \"MatchGameSelected\": {\n      if (model.workflow.tag !== \"MATCH_EXISTING\") {\n        return [model, noCmd];\n      }\n      return [\n        {\n          ...model,\n          workflow: {\n            ...model.workflow,\n            selected: msg.gameId,\n          },\n        },\n        noCmd,\n      ];\n    }\n    case \"ContinueSelectedGame\": {\n      if (model.workflow.tag !== \"MATCH_EXISTING\") {\n        return [model, noCmd];\n      }\n      const baseId = model.workflow.selected;\n      if (!baseId) {\n        return [withStatus(model, \"No game selected\"), noCmd];\n      }\n      const nextGames = updateGame(model.games, model.workflow.pending.gameId, (game) => ({\n        ...game,\n        pending: false,\n      }));\n      const session = createReachSession(model, model.workflow.pending, baseId);\n      const nextModel = {\n        ...model,\n        games: nextGames,\n        placementKeyIndex: buildPlacementIndex(nextGames),\n        workflow: { tag: \"REACHING\", session },\n        isDirty: true,\n      };\n      return [nextModel, [{ tag: \"SCHEDULE_SAVE\", delayMs: 2000 }]];\n    }\n    case \"StartNewGame\": {\n      if (model.workflow.tag !== \"MATCH_EXISTING\") {\n        return [model, noCmd];\n      }\n      const nextGames = updateGame(model.games, model.workflow.pending.gameId, (game) => ({\n        ...game,\n        pending: false,\n      }));\n      const session = createReachSession(model, model.workflow.pending, null);\n      const nextModel = {\n        ...model,\n        games: nextGames,\n        placementKeyIndex: buildPlacementIndex(nextGames),\n        workflow: { tag: \"REACHING\", session },\n        isDirty: true,\n      };\n      return [nextModel, [{ tag: \"SCHEDULE_SAVE\", delayMs: 2000 }]];\n    }\n    case \"ReachStartManual\":\n      if (model.workflow.tag !== \"REACHING\") {\n        return [model, noCmd];\n      }\n      return [\n        {\n          ...model,\n          workflow: {\n            ...model.workflow,\n            session: { ...model.workflow.session, mode: \"manual\" },\n          },\n        },\n        noCmd,\n      ];\n    case \"ReachStartOtb\":\n      if (model.workflow.tag !== \"REACHING\") {\n        return [model, noCmd];\n      }\n      return [\n        {\n          ...model,\n          workflow: {\n            ...model.workflow,\n            session: { ...model.workflow.session, mode: \"otb\" },\n          },\n        },\n        [{ tag: \"CHESSNUT_POLL_START\", everyMs: 500 }],\n      ];\n    case \"ReachMoveMade\":\n      if (model.workflow.tag !== \"REACHING\") {\n        return [model, noCmd];\n      }\n      return [\n        {\n          ...model,\n          workflow: {\n            ...model.workflow,\n            session: {\n              ...model.workflow.session,\n              moves: [...model.workflow.session.moves, msg.san],\n              currentFen: msg.fen,\n            },\n          },\n        },\n        [{ tag: \"REACH_SYNC_BOARD\", fen: extractPlacement(msg.fen) }],\n      ];\n    case \"ReachUndo\":\n      if (model.workflow.tag !== \"REACHING\") {\n        return [model, noCmd];\n      }\n      if (model.workflow.session.moves.length === 0) {\n        return [model, noCmd];\n      }\n      try {\n        const remaining = model.workflow.session.moves.slice(0, -1);\n        const game = new Chess(model.workflow.session.startFen);\n        for (const san of remaining) {\n          if (!game.move(String(san))) break;\n        }\n        return [\n          {\n            ...model,\n            workflow: {\n              ...model.workflow,\n              session: {\n                ...model.workflow.session,\n                moves: remaining,\n                currentFen: asFenFull(game.fen()),\n              },\n            },\n          },\n          noCmd,\n        ];\n      } catch {\n        return [model, noCmd];\n      }\n    case \"ReachReset\":\n      if (model.workflow.tag !== \"REACHING\") {\n        return [model, noCmd];\n      }\n      return [\n        {\n          ...model,\n          workflow: {\n            ...model.workflow,\n            session: {\n              ...model.workflow.session,\n              moves: [],\n              currentFen: model.workflow.session.startFen,\n            },\n          },\n        },\n        noCmd,\n      ];\n    case \"ReachDone\":\n      if (model.workflow.tag !== \"REACHING\") {\n        return [model, noCmd];\n      }\n      return [\n        model,\n        [\n          {\n            tag: \"REACH_SET_MOVES\",\n            moves: model.workflow.session.moves,\n            finalFen: model.workflow.session.currentFen,\n          },\n        ],\n      ];\n    case \"ReachCancel\":\n      if (model.workflow.tag !== \"REACHING\") {\n        return [model, noCmd];\n      }\n      const filtered = model.games.filter((game) => game.id !== model.workflow.session.gameId);\n      return [\n        {\n          ...model,\n          games: filtered,\n          placementKeyIndex: buildPlacementIndex(filtered),\n          workflow: { tag: \"VIEWING\", activeGameId: null },\n          currentNode: null,\n        },\n        [\n          { tag: \"CLOSE_REACH_MODAL\" },\n          { tag: \"CHESSNUT_POLL_STOP\" },\n          { tag: \"SCHEDULE_SAVE\", delayMs: 2000 },\n        ],\n      ];\n    case \"ReachTargetResolved\":\n      if (model.workflow.tag !== \"REACHING\") {\n        return [model, noCmd];\n      }\n      try {\n        const session = model.workflow.session;\n        const baseId = session.baseAnalysisId;\n        let tree =\n          baseId && model.analyses[baseId]\n            ? model.analyses[baseId]\n            : createAnalysisTree(session.startFen, session.turn);\n        let cursor = baseId && model.analyses[baseId] ? getMainLineLeaf(tree).path : [];\n        const game = new Chess(session.startFen);\n        for (const san of msg.moves) {\n          const move = game.move(String(san));\n          if (!move) break;\n          const next = makeMove(tree, cursor, asSan(move.san), asFenFull(game.fen()));\n          tree = next.tree;\n          cursor = next.cursor;\n        }\n        const analyses = baseId\n          ? { ...model.analyses, [baseId]: tree }\n          : { ...model.analyses, [session.gameId]: tree };\n        const continuations = baseId\n          ? {\n              ...model.continuations,\n              [session.gameId]: { analysisId: baseId, nodePath: cursor },\n            }\n          : model.continuations;\n        const nextModel = {\n          ...model,\n          analyses,\n          continuations,\n          currentNode: cursor,\n          isDirty: true,\n          workflow: { tag: \"ANALYSIS\", activeGameId: session.gameId, cursor },\n        };\n        return [\n          nextModel,\n          [\n            { tag: \"ENGINE_ANALYZE\", fen: msg.finalFen, depth: 16 },\n            { tag: \"SCHEDULE_SAVE\", delayMs: 2000 },\n          ],\n        ];\n      } catch {\n        return [withStatus(model, \"Failed to reach target\"), noCmd];\n      }\n    case \"TextSelectModeChanged\":\n      {\n        const message =\n          msg.mode === \"ocr\"\n            ? \"Draw a box around the move text on the PDF\"\n            : msg.mode === \"overlay\"\n              ? \"Draw a box to overlay extracted text\"\n              : model.ui.statusMessage;\n        return [\n          {\n            ...model,\n            ui: {\n              ...model.ui,\n              textSelectMode: msg.mode,\n              statusMessage: message,\n            },\n          },\n          noCmd,\n        ];\n      }\n    case \"TextOverlayUpdated\":\n      return [\n        {\n          ...model,\n          ui: {\n            ...model.ui,\n            textOverlayText: msg.text,\n            textOverlayVisible: msg.visible,\n          },\n        },\n        noCmd,\n      ];\n    case \"OcrStatusUpdated\":\n      return [\n        {\n          ...model,\n          ui: {\n            ...model.ui,\n            ocrStatus: msg.text,\n          },\n        },\n        noCmd,\n      ];\n    case \"ExtractMovesRequested\":\n      if (!model.pdf.id) {\n        return [model, noCmd];\n      }\n      return [\n        {\n          ...model,\n          ui: {\n            ...model.ui,\n            ocrStatus: \"Extracting text...\",\n          },\n        },\n        [\n          {\n            tag: \"API_EXTRACT_MOVES\",\n            pdfId: model.pdf.id,\n            page: msg.page,\n            bbox: msg.bbox,\n          },\n        ],\n      ];\n    case \"ExtractMovesFailed\":\n      return [withStatus(model, msg.message), noCmd];\n    case \"AnalysisStarted\": {\n      const position = model.games.find((game) => game.id === msg.gameId);\n      if (!position) {\n        return [model, noCmd];\n      }\n      const continuation = model.continuations[msg.gameId];\n      if (continuation && model.analyses[continuation.analysisId]) {\n        const tree = model.analyses[continuation.analysisId];\n        const node = getNode(tree.root, continuation.nodePath);\n        const fen = node ? node.fen : tree.startFen;\n        const nextModel = {\n          ...model,\n          currentNode: continuation.nodePath,\n          workflow: {\n            tag: \"ANALYSIS\",\n            activeGameId: msg.gameId,\n            cursor: continuation.nodePath,\n          },\n        };\n        return [nextModel, [{ tag: \"ENGINE_ANALYZE\", fen, depth: 16 }]];\n      }\n      const fullFen = toFullFen(position.fen, msg.turn);\n      const existing = model.analyses[msg.gameId];\n      const tree = existing ?? createAnalysisTree(fullFen, msg.turn);\n      const nextModel = {\n        ...model,\n        analyses: existing ? model.analyses : { ...model.analyses, [msg.gameId]: tree },\n        currentNode: [],\n        workflow: { tag: \"ANALYSIS\", activeGameId: msg.gameId, cursor: [] },\n      };\n      return [nextModel, [{ tag: \"ENGINE_ANALYZE\", fen: fullFen, depth: 16 }]];\n    }\n    case \"AnalysisMoveMade\":\n      if (model.workflow.tag !== \"ANALYSIS\") {\n        return [model, noCmd];\n      }\n      {\n        const ctx = getAnalysisContext(model, model.workflow.activeGameId);\n        if (!ctx) return [model, noCmd];\n        const next = makeMove(ctx.tree, model.workflow.cursor, msg.san, msg.fen);\n        const nextModel = {\n          ...model,\n          analyses: { ...model.analyses, [ctx.analysisId]: next.tree },\n          currentNode: next.cursor,\n          workflow: { ...model.workflow, cursor: next.cursor },\n          isDirty: true,\n        };\n        const cmds = [\n          { tag: \"SCHEDULE_SAVE\", delayMs: 2000 },\n          ...(model.engine.running ? [{ tag: \"ENGINE_ANALYZE\", fen: msg.fen, depth: 16 }] : []),\n        ];\n        return [nextModel, cmds];\n      }\n    case \"AnalysisGoBack\": {\n      if (model.workflow.tag !== \"ANALYSIS\") return [model, noCmd];\n      const ctx = getAnalysisContext(model, model.workflow.activeGameId);\n      if (!ctx) return [model, noCmd];\n      const nextCursor = goBack(model.workflow.cursor);\n      if (!nextCursor) return [model, noCmd];\n      const node = getNode(ctx.tree.root, nextCursor);\n      if (!node) return [model, noCmd];\n      const nextModel = {\n        ...model,\n        currentNode: nextCursor,\n        workflow: { ...model.workflow, cursor: nextCursor },\n      };\n      const cmds = model.engine.running\n        ? [{ tag: \"ENGINE_ANALYZE\", fen: node.fen, depth: 16 }]\n        : noCmd;\n      return [nextModel, cmds];\n    }\n    case \"AnalysisGoForward\": {\n      if (model.workflow.tag !== \"ANALYSIS\") return [model, noCmd];\n      const ctx = getAnalysisContext(model, model.workflow.activeGameId);\n      if (!ctx) return [model, noCmd];\n      const nextCursor = goForward(ctx.tree, model.workflow.cursor);\n      if (!nextCursor) return [model, noCmd];\n      const node = getNode(ctx.tree.root, nextCursor);\n      if (!node) return [model, noCmd];\n      const nextModel = {\n        ...model,\n        currentNode: nextCursor,\n        workflow: { ...model.workflow, cursor: nextCursor },\n      };\n      const cmds = model.engine.running\n        ? [{ tag: \"ENGINE_ANALYZE\", fen: node.fen, depth: 16 }]\n        : noCmd;\n      return [nextModel, cmds];\n    }\n    case \"AnalysisNextVariation\": {\n      if (model.workflow.tag !== \"ANALYSIS\") return [model, noCmd];\n      const ctx = getAnalysisContext(model, model.workflow.activeGameId);\n      if (!ctx) return [model, noCmd];\n      const nextCursor = getNextVariation(ctx.tree, model.workflow.cursor);\n      if (!nextCursor) return [model, noCmd];\n      const node = getNode(ctx.tree.root, nextCursor);\n      if (!node) return [model, noCmd];\n      return [\n        {\n          ...model,\n          currentNode: nextCursor,\n          workflow: { ...model.workflow, cursor: nextCursor },\n        },\n        model.engine.running ? [{ tag: \"ENGINE_ANALYZE\", fen: node.fen, depth: 16 }] : noCmd,\n      ];\n    }\n    case \"AnalysisPrevVariation\": {\n      if (model.workflow.tag !== \"ANALYSIS\") return [model, noCmd];\n      const ctx = getAnalysisContext(model, model.workflow.activeGameId);\n      if (!ctx) return [model, noCmd];\n      const nextCursor = getPrevVariation(ctx.tree, model.workflow.cursor);\n      if (!nextCursor) return [model, noCmd];\n      const node = getNode(ctx.tree.root, nextCursor);\n      if (!node) return [model, noCmd];\n      return [\n        {\n          ...model,\n          currentNode: nextCursor,\n          workflow: { ...model.workflow, cursor: nextCursor },\n        },\n        model.engine.running ? [{ tag: \"ENGINE_ANALYZE\", fen: node.fen, depth: 16 }] : noCmd,\n      ];\n    }\n    case \"AnalysisDeleteVariation\": {\n      if (model.workflow.tag !== \"ANALYSIS\") return [model, noCmd];\n      const ctx = getAnalysisContext(model, model.workflow.activeGameId);\n      if (!ctx) return [model, noCmd];\n      const result = deleteVariation(ctx.tree, model.workflow.cursor);\n      if (!result.deleted) return [model, noCmd];\n      const nextModel = {\n        ...model,\n        analyses: { ...model.analyses, [ctx.analysisId]: result.tree },\n        currentNode: result.cursor,\n        workflow: { ...model.workflow, cursor: result.cursor },\n        isDirty: true,\n      };\n      return [nextModel, [{ tag: \"SCHEDULE_SAVE\", delayMs: 2000 }]];\n    }\n    case \"AnalysisGoTo\": {\n      if (model.workflow.tag !== \"ANALYSIS\") return [model, noCmd];\n      const ctx = getAnalysisContext(model, model.workflow.activeGameId);\n      if (!ctx) return [model, noCmd];\n      const node = getNode(ctx.tree.root, msg.path);\n      if (!node) return [model, noCmd];\n      const nextModel = {\n        ...model,\n        currentNode: msg.path,\n        workflow: { ...model.workflow, cursor: msg.path },\n      };\n      const cmds = model.engine.running\n        ? [{ tag: \"ENGINE_ANALYZE\", fen: node.fen, depth: 16 }]\n        : noCmd;\n      return [nextModel, cmds];\n    }\n    case \"EngineStarted\":\n      return [\n        {\n          ...model,\n          engine: { ...model.engine, running: true },\n        },\n        noCmd,\n      ];\n    case \"EngineStopped\":\n      return [\n        {\n          ...model,\n          engine: { ...model.engine, running: false },\n        },\n        noCmd,\n      ];\n    case \"EngineInfo\":\n      return [\n        {\n          ...model,\n          engine: {\n            ...model.engine,\n            evalText: msg.evalText,\n            pv: msg.pv,\n          },\n        },\n        noCmd,\n      ];\n    case \"EngineToggle\":\n      return [model, [model.engine.running ? { tag: \"ENGINE_STOP\" } : { tag: \"ENGINE_START\" }]];\n    case \"StudySaved\":\n      return [{ ...model, isDirty: false }, noCmd];\n    case \"StudyLoaded\": {\n      const nextModel = applyStudy(model, msg.study);\n      return [nextModel, noCmd];\n    }\n    case \"BoardStatusUpdated\":\n      return [\n        {\n          ...model,\n          boardStatus: { available: msg.available, connected: msg.connected },\n        },\n        noCmd,\n      ];\n    case \"BoardFenUpdated\":\n      if (model.workflow.tag !== \"REACHING\") {\n        return [model, noCmd];\n      }\n      if (model.workflow.session.mode !== \"otb\") {\n        return [model, noCmd];\n      }\n      try {\n        const currentPlacement = extractPlacement(model.workflow.session.currentFen);\n        const nextPlacement = extractPlacement(msg.fen);\n        if (currentPlacement === nextPlacement) {\n          return [model, noCmd];\n        }\n        const baseGame = new Chess(model.workflow.session.currentFen);\n        const moves = baseGame.moves({ verbose: true });\n        for (const move of moves) {\n          const testGame = new Chess(model.workflow.session.currentFen);\n          testGame.move(move);\n          const resultFen = asFenFull(testGame.fen());\n          if (extractPlacement(resultFen) === nextPlacement) {\n            return [\n              {\n                ...model,\n                workflow: {\n                  ...model.workflow,\n                  session: {\n                    ...model.workflow.session,\n                    moves: [...model.workflow.session.moves, asSan(move.san)],\n                    currentFen: resultFen,\n                  },\n                },\n              },\n              noCmd,\n            ];\n          }\n        }\n      } catch {\n        return [model, noCmd];\n      }\n      return [model, noCmd];\n    case \"CopyFen\":\n      {\n        const activeId = getActiveGameId(model.workflow);\n        const ctx = activeId ? getAnalysisContext(model, activeId) : null;\n        if (ctx) {\n          const node = getNode(ctx.tree.root, ctx.nodePath);\n          if (node) {\n            return [model, [{ tag: \"CLIPBOARD_WRITE\", text: node.fen }]];\n          }\n        }\n        const active = model.games.find((game) => game.id === activeId);\n        return active\n          ? [model, [{ tag: \"CLIPBOARD_WRITE\", text: active.fen }]]\n          : [model, noCmd];\n      }\n    case \"CopyPgn\": {\n      const activeId = getActiveGameId(model.workflow);\n      if (!activeId) return [model, noCmd];\n      const ctx = getAnalysisContext(model, activeId);\n      if (!ctx) return [model, noCmd];\n      const pgn = toPGN(ctx.tree);\n      return [model, [{ tag: \"CLIPBOARD_WRITE\", text: pgn }]];\n    }\n    case \"OpeningsInputShown\":\n      return [\n        {\n          ...model,\n          ui: { ...model.ui, openingInputVisible: true, openingMovesInput: msg.content },\n        },\n        noCmd,\n      ];\n    case \"OpeningsInputHidden\":\n      return [\n        {\n          ...model,\n          ui: { ...model.ui, openingInputVisible: false },\n        },\n        noCmd,\n      ];\n    default:\n      return assertNever(msg);\n  }\n};\n", "export const byId = <T extends HTMLElement>(id: string): T => {\n    const el = document.getElementById(id);\n    if (!el) {\n        throw new Error(`Missing element: ${id}`);\n    }\n    return el as T;\n};\n\n// Lazy element cache - only populated after DOM is ready\nlet _els: ReturnType<typeof initEls> | null = null;\n\nconst initEls = () => ({\n    pdfInput: byId<HTMLInputElement>(\"pdf-input\"),\n    btnOpen: byId<HTMLButtonElement>(\"btn-open\"),\n    pdfInfo: byId<HTMLSpanElement>(\"pdf-info\"),\n    btnPrevPage: byId<HTMLButtonElement>(\"btn-prev-page\"),\n    btnNextPage: byId<HTMLButtonElement>(\"btn-next-page\"),\n    pageInfo: byId<HTMLSpanElement>(\"page-info\"),\n    pageInput: byId<HTMLInputElement>(\"page-input\"),\n    btnGotoPage: byId<HTMLButtonElement>(\"btn-goto-page\"),\n    zoomSlider: byId<HTMLInputElement>(\"zoom-slider\"),\n    zoomValue: byId<HTMLSpanElement>(\"zoom-value\"),\n    pdfViewport: byId<HTMLDivElement>(\"pdf-viewport\"),\n    pdfPageContainer: byId<HTMLDivElement>(\"pdf-page-container\"),\n    pdfCanvas: byId<HTMLCanvasElement>(\"pdf-canvas\"),\n    detectionOverlay: byId<SVGSVGElement>(\"detection-overlay\"),\n    boardOverlay: byId<HTMLDivElement>(\"board-overlay\"),\n    btnCloseBoard: byId<HTMLButtonElement>(\"btn-close-board\"),\n    activeBoard: byId<HTMLDivElement>(\"active-board\"),\n    textOverlay: byId<HTMLDivElement>(\"text-overlay\"),\n    noPdfMessage: byId<HTMLDivElement>(\"no-pdf-message\"),\n    positionList: byId<HTMLDivElement>(\"position-list\"),\n    analysisContainer: byId<HTMLDivElement>(\"analysis-container\"),\n    pgnViewer: byId<HTMLDivElement>(\"pgn-viewer\"),\n    enginePanel: byId<HTMLDivElement>(\"engine-panel\"),\n    engineEval: byId<HTMLDivElement>(\"engine-eval\"),\n    engineLine: byId<HTMLDivElement>(\"engine-line\"),\n    btnToggleEngine: byId<HTMLButtonElement>(\"btn-toggle-engine\"),\n    btnAnalyseWhite: byId<HTMLButtonElement>(\"btn-analyse-white\"),\n    btnAnalyseBlack: byId<HTMLButtonElement>(\"btn-analyse-black\"),\n    btnCopyFen: byId<HTMLButtonElement>(\"btn-copy-fen\"),\n    btnCopyPgn: byId<HTMLButtonElement>(\"btn-copy-pgn\"),\n    btnSelectText: byId<HTMLButtonElement>(\"btn-select-text\"),\n    statusBar: byId<HTMLSpanElement>(\"status-bar\"),\n    boardStatus: byId<HTMLSpanElement>(\"board-status\"),\n    paletteBlack: byId<HTMLDivElement>(\"piece-palette-black\"),\n    paletteWhite: byId<HTMLDivElement>(\"piece-palette-white\"),\n    workflowPanel: byId<HTMLDivElement>(\"workflow-panel\"),\n    confirmPanel: byId<HTMLDivElement>(\"confirm-panel\"),\n    btnConfirmPieces: byId<HTMLButtonElement>(\"btn-confirm-pieces\"),\n    btnEditPieces: byId<HTMLButtonElement>(\"btn-edit-pieces\"),\n    gameMatchPanel: byId<HTMLDivElement>(\"game-match-panel\"),\n    gameMatchList: byId<HTMLDivElement>(\"game-match-list\"),\n    btnContinueGame: byId<HTMLButtonElement>(\"btn-continue-game\"),\n    btnNewGame: byId<HTMLButtonElement>(\"btn-new-game\"),\n    reachPanel: byId<HTMLDivElement>(\"reach-panel\"),\n    btnReachOtb: byId<HTMLButtonElement>(\"btn-reach-otb\"),\n    btnReachOcr: byId<HTMLButtonElement>(\"btn-reach-ocr\"),\n    otbPanel: byId<HTMLDivElement>(\"otb-panel\"),\n    otbStatus: byId<HTMLDivElement>(\"otb-status\"),\n    btnStopOtb: byId<HTMLButtonElement>(\"btn-stop-otb\"),\n    ocrPanel: byId<HTMLDivElement>(\"ocr-panel\"),\n    btnStartTextSelect: byId<HTMLButtonElement>(\"btn-start-text-select\"),\n    ocrStatus: byId<HTMLDivElement>(\"ocr-status\"),\n    continuationPrompt: byId<HTMLDivElement>(\"continuation-prompt\"),\n    continuationInfo: byId<HTMLDivElement>(\"continuation-info\"),\n    btnAcceptContinuation: byId<HTMLButtonElement>(\"btn-accept-continuation\"),\n    btnDismissContinuation: byId<HTMLButtonElement>(\"btn-dismiss-continuation\"),\n    openingInputPanel: byId<HTMLDivElement>(\"opening-input-panel\"),\n    openingMovesInput: byId<HTMLTextAreaElement>(\"opening-moves-input\"),\n    btnSetOpening: byId<HTMLButtonElement>(\"btn-set-opening\"),\n    btnApplyOpening: byId<HTMLButtonElement>(\"btn-apply-opening\"),\n    btnCancelOpening: byId<HTMLButtonElement>(\"btn-cancel-opening\"),\n    reachModal: byId<HTMLDivElement>(\"reach-modal\"),\n    reachModalClose: byId<HTMLButtonElement>(\"reach-modal-close\"),\n    reachStartBoard: byId<HTMLDivElement>(\"reach-start-board\"),\n    reachEntryBoard: byId<HTMLDivElement>(\"reach-entry-board\"),\n    reachTargetBoard: byId<HTMLDivElement>(\"reach-target-board\"),\n    reachStartLabel: byId<HTMLDivElement>(\"reach-start-label\"),\n    reachMoveList: byId<HTMLDivElement>(\"reach-move-list\"),\n    reachStatus: byId<HTMLDivElement>(\"reach-status\"),\n    reachIndicator: byId<HTMLDivElement>(\"reach-indicator\"),\n    reachBtnUndo: byId<HTMLButtonElement>(\"reach-btn-undo\"),\n    reachBtnReset: byId<HTMLButtonElement>(\"reach-btn-reset\"),\n    reachBtnDone: byId<HTMLButtonElement>(\"reach-btn-done\"),\n    reachBtnCancel: byId<HTMLButtonElement>(\"reach-btn-cancel\"),\n    // Board row elements\n    boardRow: byId<HTMLDivElement>(\"board-row\"),\n    boardSlotBefore: byId<HTMLDivElement>(\"board-slot-before\"),\n    boardSlotNow: byId<HTMLDivElement>(\"board-slot-now\"),\n    boardSlotAfter: byId<HTMLDivElement>(\"board-slot-after\"),\n    beforeBoard: byId<HTMLDivElement>(\"before-board\"),\n    nowBoard: byId<HTMLDivElement>(\"now-board\"),\n    afterBoard: byId<HTMLDivElement>(\"after-board\"),\n    beforeBoardInfo: byId<HTMLDivElement>(\"before-board-info\"),\n    nowBoardInfo: byId<HTMLDivElement>(\"now-board-info\"),\n    afterBoardInfo: byId<HTMLDivElement>(\"after-board-info\"),\n    boardRowActions: byId<HTMLDivElement>(\"board-row-actions\"),\n    boardRowReachIndicator: byId<HTMLSpanElement>(\"board-row-reach-indicator\"),\n    // Board row action groups\n    boardRowConfirm: byId<HTMLDivElement>(\"board-row-confirm\"),\n    boardRowMatch: byId<HTMLDivElement>(\"board-row-match\"),\n    boardRowReach: byId<HTMLDivElement>(\"board-row-reach\"),\n    boardRowAnalysis: byId<HTMLDivElement>(\"board-row-analysis\"),\n    boardRowHowReach: byId<HTMLDivElement>(\"board-row-how-reach\"),\n    // Board row buttons - confirm\n    btnRowConfirm: byId<HTMLButtonElement>(\"btn-row-confirm\"),\n    btnRowEdit: byId<HTMLButtonElement>(\"btn-row-edit\"),\n    // Board row buttons - match\n    matchGameSelect: byId<HTMLSelectElement>(\"match-game-select\"),\n    btnRowContinue: byId<HTMLButtonElement>(\"btn-row-continue\"),\n    btnRowNewGame: byId<HTMLButtonElement>(\"btn-row-new-game\"),\n    // Board row buttons - reach\n    boardRowReachStatus: byId<HTMLSpanElement>(\"board-row-reach-status\"),\n    btnRowUndo: byId<HTMLButtonElement>(\"btn-row-undo\"),\n    btnRowReset: byId<HTMLButtonElement>(\"btn-row-reset\"),\n    btnRowDone: byId<HTMLButtonElement>(\"btn-row-done\"),\n    btnRowCancel: byId<HTMLButtonElement>(\"btn-row-cancel\"),\n    // Board row buttons - analysis\n    btnRowAnalyseWhite: byId<HTMLButtonElement>(\"btn-row-analyse-white\"),\n    btnRowAnalyseBlack: byId<HTMLButtonElement>(\"btn-row-analyse-black\"),\n    btnRowCopyFen: byId<HTMLButtonElement>(\"btn-row-copy-fen\"),\n    btnRowCopyPgn: byId<HTMLButtonElement>(\"btn-row-copy-pgn\"),\n    btnRowClose: byId<HTMLButtonElement>(\"btn-row-close\"),\n    // Board row buttons - how to reach\n    btnRowOtb: byId<HTMLButtonElement>(\"btn-row-otb\"),\n    btnRowManual: byId<HTMLButtonElement>(\"btn-row-manual\"),\n});\n\n// Proxy that lazily initializes els on first access\nexport const els: ReturnType<typeof initEls> = new Proxy({} as ReturnType<typeof initEls>, {\n    get(_target, prop: string) {\n        if (!_els) {\n            _els = initEls();\n        }\n        return _els[prop as keyof typeof _els];\n    },\n});\n", "import type { CssBBox } from \"../../domain/pdf/bbox\";\nimport { bbox } from \"../../domain/pdf/bbox\";\nimport { asCssPx } from \"../../core/model\";\n\ntype OverlayHandlers = Readonly<{\n  onClick: (rect: CssBBox, index: number) => void;\n  onResize: (rect: CssBBox) => void;\n}>;\n\ntype ResizeState = {\n  rect: SVGRectElement;\n  corner: \"nw\" | \"ne\" | \"sw\" | \"se\";\n  startX: number;\n  startY: number;\n  origX: number;\n  origY: number;\n  origW: number;\n  origH: number;\n  onResize: (rect: CssBBox) => void;\n};\n\nlet resizeState: ResizeState | null = null;\n\nconst parseAttr = (rect: SVGRectElement, attr: string): number =>\n  Number.parseFloat(rect.getAttribute(attr) ?? \"0\");\n\nconst rectToBBox = (rect: SVGRectElement): CssBBox =>\n  bbox(\n    asCssPx(parseAttr(rect, \"x\")),\n    asCssPx(parseAttr(rect, \"y\")),\n    asCssPx(parseAttr(rect, \"width\")),\n    asCssPx(parseAttr(rect, \"height\")),\n  );\n\nconst startResize = (\n  event: MouseEvent,\n  rect: SVGRectElement,\n  corner: ResizeState[\"corner\"],\n  onResize: (rect: CssBBox) => void,\n): void => {\n  event.stopPropagation();\n  resizeState = {\n    rect,\n    corner,\n    startX: event.clientX,\n    startY: event.clientY,\n    origX: parseAttr(rect, \"x\"),\n    origY: parseAttr(rect, \"y\"),\n    origW: parseAttr(rect, \"width\"),\n    origH: parseAttr(rect, \"height\"),\n    onResize,\n  };\n  document.addEventListener(\"mousemove\", doResize);\n  document.addEventListener(\"mouseup\", endResize);\n};\n\nconst doResize = (event: MouseEvent): void => {\n  if (!resizeState) return;\n  const dx = event.clientX - resizeState.startX;\n  const dy = event.clientY - resizeState.startY;\n  const { origX, origY, origW, origH } = resizeState;\n  switch (resizeState.corner) {\n    case \"nw\":\n      resizeState.rect.setAttribute(\"x\", String(origX + dx));\n      resizeState.rect.setAttribute(\"y\", String(origY + dy));\n      resizeState.rect.setAttribute(\"width\", String(origW - dx));\n      resizeState.rect.setAttribute(\"height\", String(origH - dy));\n      break;\n    case \"ne\":\n      resizeState.rect.setAttribute(\"y\", String(origY + dy));\n      resizeState.rect.setAttribute(\"width\", String(origW + dx));\n      resizeState.rect.setAttribute(\"height\", String(origH - dy));\n      break;\n    case \"sw\":\n      resizeState.rect.setAttribute(\"x\", String(origX + dx));\n      resizeState.rect.setAttribute(\"width\", String(origW - dx));\n      resizeState.rect.setAttribute(\"height\", String(origH + dy));\n      break;\n    case \"se\":\n      resizeState.rect.setAttribute(\"width\", String(origW + dx));\n      resizeState.rect.setAttribute(\"height\", String(origH + dy));\n      break;\n    default:\n      break;\n  }\n};\n\nconst endResize = (): void => {\n  if (!resizeState) return;\n  const { rect, onResize } = resizeState;\n  resizeState = null;\n  document.removeEventListener(\"mousemove\", doResize);\n  document.removeEventListener(\"mouseup\", endResize);\n  onResize(rectToBBox(rect));\n};\n\nexport const clearOverlay = (overlay: SVGSVGElement): void => {\n  overlay.innerHTML = \"\";\n};\n\nexport const renderOverlay = (\n  overlay: SVGSVGElement,\n  diagrams: ReadonlyArray<CssBBox>,\n  handlers: OverlayHandlers,\n  activeIndex: number | null,\n  loadingIndex: number | null = null,\n): void => {\n  clearOverlay(overlay);\n\n  // Clear any existing click handler\n  overlay.onclick = null;\n\n  diagrams.forEach((diagram, index) => {\n    const rect = document.createElementNS(\"http://www.w3.org/2000/svg\", \"rect\");\n    rect.setAttribute(\"x\", String(diagram.x));\n    rect.setAttribute(\"y\", String(diagram.y));\n    rect.setAttribute(\"width\", String(diagram.width));\n    rect.setAttribute(\"height\", String(diagram.height));\n    rect.setAttribute(\"data-index\", String(index));\n    rect.classList.add(\"detection-box\");\n    if (activeIndex === index) {\n      rect.classList.add(\"active\");\n    }\n    if (loadingIndex === index) {\n      rect.classList.add(\"loading\");\n      // Add loading spinner\n      const cx = (diagram.x as number) + (diagram.width as number) / 2;\n      const cy = (diagram.y as number) + (diagram.height as number) / 2;\n      const spinner = document.createElementNS(\"http://www.w3.org/2000/svg\", \"circle\");\n      spinner.setAttribute(\"cx\", String(cx));\n      spinner.setAttribute(\"cy\", String(cy));\n      spinner.setAttribute(\"r\", \"20\");\n      spinner.classList.add(\"loading-spinner\");\n      overlay.appendChild(spinner);\n    }\n    // Direct click handler on the rect element\n    const handleClick = (e: Event) => {\n      console.log(\"[DEBUG] RECT CLICK FIRED! index:\", index, \"event type:\", e.type);\n      e.stopPropagation();\n      e.preventDefault();\n      handlers.onClick(rectToBBox(rect), index);\n    };\n    rect.addEventListener(\"click\", handleClick);\n    rect.addEventListener(\"touchend\", handleClick);\n    // Make sure rect is clickable\n    rect.style.pointerEvents = \"auto\";\n    rect.style.cursor = \"pointer\";\n    console.log(\"[DEBUG] Appending rect\", index, \"at\", diagram.x, diagram.y, diagram.width, diagram.height);\n    overlay.appendChild(rect);\n    addResizeHandles(overlay, rect, handlers.onResize);\n  });\n};\n\nconst addResizeHandles = (\n  overlay: SVGSVGElement,\n  rect: SVGRectElement,\n  onResize: (rect: CssBBox) => void,\n): void => {\n  const corners: Array<ResizeState[\"corner\"]> = [\"nw\", \"ne\", \"sw\", \"se\"];\n  const x = parseAttr(rect, \"x\");\n  const y = parseAttr(rect, \"y\");\n  const w = parseAttr(rect, \"width\");\n  const h = parseAttr(rect, \"height\");\n\n  corners.forEach((corner) => {\n    const handle = document.createElementNS(\"http://www.w3.org/2000/svg\", \"circle\");\n    handle.setAttribute(\"r\", \"5\");\n    handle.classList.add(\"resize-handle\");\n    let cx = x;\n    let cy = y;\n    switch (corner) {\n      case \"ne\":\n        cx = x + w;\n        cy = y;\n        break;\n      case \"sw\":\n        cx = x;\n        cy = y + h;\n        break;\n      case \"se\":\n        cx = x + w;\n        cy = y + h;\n        break;\n      default:\n        break;\n    }\n    handle.setAttribute(\"cx\", String(cx));\n    handle.setAttribute(\"cy\", String(cy));\n    handle.addEventListener(\"mousedown\", (event) => startResize(event, rect, corner, onResize));\n    overlay.appendChild(handle);\n  });\n};\n", "import type { Msg } from \"../core/msg\";\nimport type { Model, GameId } from \"../core/model\";\nimport { getActiveGame, getActiveGameId } from \"../core/selectors\";\nimport { pdfToCssBBox } from \"../domain/pdf/bbox\";\nimport { els } from \"./dom\";\nimport { asSan } from \"../domain/chess/san\";\nimport { clearOverlay, renderOverlay } from \"./adapters/overlay\";\n\n// Board row mode determines which boards and actions to show\ntype BoardRowMode =\n  | { tag: \"hidden\" }\n  | { tag: \"confirm\"; fen: string }\n  | { tag: \"match\"; beforeFen: string | null; nowFen: string; candidates: ReadonlyArray<GameId> }\n  | { tag: \"reach\"; beforeFen: string; nowFen: string; afterFen: string; moves: number; reached: boolean }\n  | { tag: \"analysis\"; fen: string }\n  | { tag: \"howReach\"; fen: string };\n\ntype Dispatch = (msg: Msg) => void;\n\nconst toggleHidden = (el: HTMLElement, visible: boolean): void => {\n  el.classList.toggle(\"hidden\", !visible);\n};\n\nconst setText = (el: HTMLElement, text: string): void => {\n  el.textContent = text;\n};\n\nconst updateBoardStatus = (available: boolean, connected: boolean): void => {\n  els.boardStatus.classList.remove(\"offline\", \"online\", \"connected\");\n  const textEl = els.boardStatus.querySelector(\".board-status-text\");\n  if (connected) {\n    els.boardStatus.classList.add(\"connected\");\n    if (textEl) textEl.textContent = \"\u265F Board ready\";\n  } else if (available) {\n    els.boardStatus.classList.add(\"online\");\n    if (textEl) textEl.textContent = \"\u26A0 No board\";\n  } else {\n    els.boardStatus.classList.add(\"offline\");\n    if (textEl) textEl.textContent = \"\u25CB Offline\";\n  }\n};\n\nconst renderPositions = (model: Model, dispatch: Dispatch): void => {\n  els.positionList.innerHTML = \"\";\n  const visibleGames = model.games.filter((game) => !game.pending);\n  const activeId = getActiveGameId(model.workflow);\n  visibleGames.forEach((game) => {\n    const item = document.createElement(\"div\");\n    item.className = \"position-item\";\n    item.dataset.id = String(game.id);\n    if (activeId === game.id) {\n      item.classList.add(\"active\");\n    }\n    if (model.analyses[game.id] || model.continuations[game.id]) {\n      item.classList.add(\"analysed\");\n    }\n    const isLinked = Boolean(model.continuations[game.id]);\n    item.innerHTML = `\n      <div class=\"thumb\">\n        <div id=\"thumb-${game.id}\" style=\"width:48px;height:48px;\"></div>\n      </div>\n      <div class=\"info\">\n        <div class=\"page-num\">Page ${game.page}${isLinked ? \" \u2197\" : \"\"}</div>\n        <div class=\"fen-preview\">${game.fen}</div>\n      </div>\n      <button class=\"btn-delete-position\" data-id=\"${game.id}\" title=\"Delete position\">\u00D7</button>\n    `;\n    const deleteBtn = item.querySelector(\".btn-delete-position\") as HTMLButtonElement | null;\n    if (deleteBtn) {\n      deleteBtn.addEventListener(\"click\", (event) => {\n        event.stopPropagation();\n        dispatch({ tag: \"DeleteGame\", gameId: game.id });\n      });\n    }\n    item.addEventListener(\"click\", () => {\n      if (model.pdf.currentPage !== game.page) {\n        dispatch({ tag: \"PageRequested\", page: game.page });\n      }\n      dispatch({ tag: \"DiagramActivated\", gameId: game.id });\n    });\n    els.positionList.appendChild(item);\n    setTimeout(() => {\n      Chessboard(`thumb-${game.id}`, {\n        position: game.fen,\n        draggable: false,\n        showNotation: false,\n        pieceTheme: \"/static/vendor/img/chesspieces/wikipedia/{piece}.png\",\n      });\n    }, 10);\n  });\n};\n\nconst renderWorkflowPanels = (model: Model): void => {\n  toggleHidden(els.confirmPanel, model.workflow.tag === \"PENDING_CONFIRM\");\n  toggleHidden(els.gameMatchPanel, model.workflow.tag === \"MATCH_EXISTING\");\n  toggleHidden(els.reachPanel, false);\n  toggleHidden(els.otbPanel, false);\n  toggleHidden(els.ocrPanel, false);\n  if (model.workflow.tag === \"MATCH_EXISTING\") {\n    els.btnContinueGame.disabled = model.workflow.candidates.length === 0;\n  }\n};\n\nconst renderOverlayBoards = (model: Model): void => {\n  const activeGame = getActiveGame(model);\n  // Only show transparent overlay in VIEWING mode (for alignment verification)\n  // In ANALYSIS, PENDING_CONFIRM, MATCH_EXISTING, and REACHING modes, use the board row instead\n  if (!activeGame || model.workflow.tag !== \"VIEWING\") {\n    toggleHidden(els.boardOverlay, false);\n    return;\n  }\n  const displayBbox = pdfToCssBBox(activeGame.bbox, model.pdf.scale);\n  els.boardOverlay.style.left = `${displayBbox.x}px`;\n  els.boardOverlay.style.top = `${displayBbox.y}px`;\n  els.boardOverlay.style.width = `${displayBbox.width}px`;\n  els.boardOverlay.style.height = `${displayBbox.height}px`;\n  els.boardOverlay.classList.add(\"transparent\");\n  els.boardOverlay.classList.remove(\"solid\");\n  toggleHidden(els.boardOverlay, true);\n};\n\nconst renderDiagramOverlay = (model: Model, dispatch: Dispatch): void => {\n  if (!model.diagrams || model.diagrams.page !== model.pdf.currentPage) {\n    clearOverlay(els.detectionOverlay);\n    return;\n  }\n  const diagrams = model.diagrams.diagrams.map((diagram) => pdfToCssBBox(diagram, model.pdf.scale));\n  const activeGame = getActiveGame(model);\n  let activeIndex: number | null = null;\n  if (activeGame) {\n    const activeBox = pdfToCssBBox(activeGame.bbox, model.pdf.scale);\n    let bestDist = Number.POSITIVE_INFINITY;\n    diagrams.forEach((diagram, index) => {\n      const dx = Math.abs((diagram.x as number) - (activeBox.x as number));\n      const dy = Math.abs((diagram.y as number) - (activeBox.y as number));\n      const dist = dx + dy;\n      if (dist < bestDist) {\n        bestDist = dist;\n        activeIndex = index;\n      }\n    });\n  }\n  renderOverlay(els.detectionOverlay, diagrams, {\n    onClick: (rect, index) => dispatch({ tag: \"DiagramClicked\", page: model.pdf.currentPage, bbox: rect, diagramIndex: index }),\n    onResize: (rect) => dispatch({ tag: \"DiagramResized\", page: model.pdf.currentPage, bbox: rect }),\n  }, activeIndex, model.recognitionInProgress);\n};\n\nconst renderAnalysis = (model: Model, dispatch: Dispatch): void => {\n  const noAnalysis = els.analysisContainer.querySelector(\".no-analysis\") as HTMLElement | null;\n  if (model.workflow.tag !== \"ANALYSIS\") {\n    if (noAnalysis) toggleHidden(noAnalysis, true);\n    toggleHidden(els.pgnViewer, false);\n    toggleHidden(els.enginePanel, false);\n    return;\n  }\n  if (noAnalysis) toggleHidden(noAnalysis, false);\n  toggleHidden(els.pgnViewer, true);\n  toggleHidden(els.enginePanel, true);\n  els.engineEval.textContent = model.engine.evalText;\n  els.engineLine.textContent = model.engine.pv;\n  els.btnToggleEngine.textContent = model.engine.running ? \"\u23F9 Stop\" : \"\u25B6 Start\";\n  const tree = model.analyses[model.workflow.activeGameId];\n  if (!tree) {\n    els.pgnViewer.textContent = \"No moves yet\";\n    return;\n  }\n  const currentPath = model.workflow.cursor;\n  const pathEquals = (a: ReadonlyArray<string>, b: ReadonlyArray<string>): boolean =>\n    a.length === b.length && a.every((item, idx) => item === b[idx]);\n  const pathIsPrefix = (prefix: ReadonlyArray<string>, full: ReadonlyArray<string>): boolean =>\n    prefix.every((item, idx) => item === full[idx]);\n\n  const renderTree = (\n    node: typeof tree.root,\n    moveNum: number,\n    isWhite: boolean,\n    path: ReadonlyArray<string>,\n    depth: number,\n  ): string => {\n    let html = \"\";\n    node.children.forEach((child, index) => {\n      if (!child.san) return;\n      const childPath = [...path, child.san];\n      const isVariation = index > 0;\n      if (isVariation && depth === 0) {\n        html += \" <span class=\\\"variation\\\">(\";\n        if (!isWhite) {\n          html += `<span class=\"move-number\">${moveNum}...</span> `;\n        }\n      }\n      if (isWhite && (index === 0 || isVariation)) {\n        html += `<span class=\"move-number\">${moveNum}.</span> `;\n      }\n      const isCurrent = pathEquals(childPath, currentPath);\n      const isOnPath = pathIsPrefix(childPath, currentPath);\n      const classes = [\"move-item\"];\n      if (isCurrent) classes.push(\"current\");\n      if (isOnPath) classes.push(\"on-path\");\n      html += `<span class=\"${classes.join(\" \")}\" data-path='${JSON.stringify(childPath)}'>${child.san}</span>`;\n      const nextMoveNum = isWhite ? moveNum : moveNum + 1;\n      html += ` ${renderTree(child, nextMoveNum, !isWhite, childPath, isVariation ? depth + 1 : depth)}`;\n      if (isVariation && depth === 0) {\n        html += \")</span>\";\n      }\n    });\n    return html;\n  };\n\n  const fenParts = tree.startFen.split(\" \");\n  const startMoveNum = Number.parseInt(fenParts[5] ?? \"1\", 10);\n  const isWhiteToMove = (fenParts[1] ?? \"w\") === \"w\";\n  const movesHtml = renderTree(tree.root, startMoveNum, isWhiteToMove, [], 0);\n  els.pgnViewer.innerHTML = `<div class=\"move-list\">${movesHtml || \"<em>No moves yet</em>\"}</div>`;\n  els.pgnViewer.querySelectorAll(\".move-item\").forEach((el) => {\n    el.addEventListener(\"click\", () => {\n      const pathRaw = (el as HTMLElement).dataset.path;\n      if (!pathRaw) return;\n      try {\n        const parsed = JSON.parse(pathRaw) as string[];\n        dispatch({ tag: \"AnalysisGoTo\", path: parsed.map(asSan) });\n      } catch {\n        return;\n      }\n    });\n  });\n};\n\nconst renderReachModal = (model: Model): void => {\n  // Always hide the modal - we use the board row instead\n  toggleHidden(els.reachModal, false);\n};\n\nconst getBoardRowMode = (model: Model): BoardRowMode => {\n  switch (model.workflow.tag) {\n    case \"NO_PDF\":\n      return { tag: \"hidden\" };\n    case \"VIEWING\":\n      // In viewing mode, we don't show the board row (transparent overlay on PDF instead)\n      return { tag: \"hidden\" };\n    case \"PENDING_CONFIRM\":\n      return { tag: \"confirm\", fen: String(model.workflow.pending.targetFen) };\n    case \"MATCH_EXISTING\": {\n      const selectedId = model.workflow.selected;\n      const selectedGame = selectedId ? model.games.find(g => g.id === selectedId) : null;\n      return {\n        tag: \"match\",\n        beforeFen: selectedGame ? String(selectedGame.fen) : null,\n        nowFen: String(model.workflow.pending.targetFen),\n        candidates: model.workflow.candidates,\n      };\n    }\n    case \"REACHING\": {\n      const session = model.workflow.session;\n      const currentPlacement = String(session.currentFen).split(\" \")[0];\n      return {\n        tag: \"reach\",\n        beforeFen: String(session.startFen),\n        nowFen: String(session.currentFen),\n        afterFen: String(session.targetFen),\n        moves: session.moves.length,\n        reached: currentPlacement === String(session.targetFen),\n      };\n    }\n    case \"ANALYSIS\": {\n      const game = model.games.find(g => g.id === model.workflow.activeGameId);\n      const tree = model.analyses[model.workflow.activeGameId];\n      // Get FEN at current cursor position\n      let fen = game?.fen ?? \"start\";\n      if (tree && model.workflow.cursor.length > 0) {\n        // Navigate to cursor position\n        let node = tree.root;\n        for (const san of model.workflow.cursor) {\n          const child = node.children.find(c => c.san === san);\n          if (child) {\n            node = child;\n          } else {\n            break;\n          }\n        }\n        fen = node.fen.split(\" \")[0]; // Just the placement part\n      }\n      return { tag: \"analysis\", fen };\n    }\n  }\n};\n\nconst renderBoardRow = (model: Model, dispatch: Dispatch): void => {\n  const mode = getBoardRowMode(model);\n\n  // Hide all action groups first\n  toggleHidden(els.boardRowConfirm, false);\n  toggleHidden(els.boardRowMatch, false);\n  toggleHidden(els.boardRowReach, false);\n  toggleHidden(els.boardRowAnalysis, false);\n  toggleHidden(els.boardRowHowReach, false);\n\n  // Hide board row if no mode\n  if (mode.tag === \"hidden\") {\n    els.boardRow.classList.add(\"hidden\");\n    return;\n  }\n\n  // Show board row\n  els.boardRow.classList.remove(\"hidden\");\n\n  // Configure slots based on mode\n  switch (mode.tag) {\n    case \"confirm\":\n      // Only \"Now\" board, confirm/edit actions\n      toggleHidden(els.boardSlotBefore, false);\n      toggleHidden(els.boardSlotAfter, false);\n      toggleHidden(els.boardRowConfirm, true);\n      setText(els.nowBoardInfo, \"Detected position\");\n      break;\n\n    case \"match\":\n      // \"Before\" (selected game) + \"Now\" (detected), match actions\n      toggleHidden(els.boardSlotBefore, mode.beforeFen !== null);\n      toggleHidden(els.boardSlotAfter, false);\n      toggleHidden(els.boardRowMatch, true);\n      setText(els.beforeBoardInfo, \"Previous game\");\n      setText(els.nowBoardInfo, \"Detected position\");\n      // Populate match game select\n      els.matchGameSelect.innerHTML = mode.candidates.map((id, idx) => {\n        const game = model.games.find(g => g.id === id);\n        return `<option value=\"${id}\">Game ${idx + 1} (Page ${game?.page ?? \"?\"})</option>`;\n      }).join(\"\");\n      break;\n\n    case \"reach\":\n      // All three boards, reach actions\n      toggleHidden(els.boardSlotBefore, true);\n      toggleHidden(els.boardSlotAfter, true);\n      toggleHidden(els.boardRowReach, true);\n      setText(els.beforeBoardInfo, \"Starting position\");\n      setText(els.nowBoardInfo, \"Enter moves here\");\n      // Update reach indicator\n      if (mode.reached) {\n        els.boardRowReachIndicator.textContent = \"\u2713 Position reached!\";\n        els.boardRowReachIndicator.classList.add(\"reached\");\n        els.boardRowReachIndicator.classList.remove(\"not-reached\");\n      } else {\n        els.boardRowReachIndicator.textContent = \"Target position\";\n        els.boardRowReachIndicator.classList.remove(\"reached\");\n        els.boardRowReachIndicator.classList.add(\"not-reached\");\n      }\n      setText(els.boardRowReachStatus, `Moves: ${mode.moves}`);\n      els.btnRowUndo.disabled = mode.moves === 0;\n      els.btnRowDone.disabled = mode.moves === 0;\n      break;\n\n    case \"analysis\":\n      // Only \"Now\" board for analysis, analysis actions\n      toggleHidden(els.boardSlotBefore, false);\n      toggleHidden(els.boardSlotAfter, false);\n      toggleHidden(els.boardRowAnalysis, true);\n      setText(els.nowBoardInfo, \"\");\n      break;\n\n    case \"howReach\":\n      // Only \"Now\" board, how-to-reach actions\n      toggleHidden(els.boardSlotBefore, false);\n      toggleHidden(els.boardSlotAfter, false);\n      toggleHidden(els.boardRowHowReach, true);\n      setText(els.nowBoardInfo, \"How to reach?\");\n      break;\n  }\n};\n\nexport const render = (model: Model, dispatch: Dispatch): void => {\n  const hasPdf = Boolean(model.pdf.id);\n  toggleHidden(els.noPdfMessage, !hasPdf);\n  setText(els.pdfInfo, model.pdf.filename ? `${model.pdf.filename} (${model.pdf.totalPages} pages)` : \"\");\n  els.btnPrevPage.disabled = model.pdf.currentPage <= 1;\n  els.btnNextPage.disabled = model.pdf.currentPage >= model.pdf.totalPages;\n  setText(els.pageInfo, `Page ${model.pdf.currentPage} / ${model.pdf.totalPages}`);\n  els.pageInput.value = String(model.pdf.currentPage);\n  const zoomPercent = Math.round(model.pdf.scale * 100);\n  els.zoomSlider.value = String(zoomPercent);\n  setText(els.zoomValue, `${zoomPercent}%`);\n  setText(els.statusBar, model.ui.statusMessage);\n  updateBoardStatus(model.boardStatus.available, model.boardStatus.connected);\n  els.textOverlay.textContent = model.ui.textOverlayText;\n  toggleHidden(els.textOverlay, model.ui.textOverlayVisible);\n  els.ocrStatus.textContent = model.ui.ocrStatus;\n  toggleHidden(els.openingInputPanel, model.ui.openingInputVisible);\n  if (model.ui.openingInputVisible) {\n    els.openingMovesInput.value = model.ui.openingMovesInput;\n  }\n  const activeGame = getActiveGame(model);\n  const hasActive = Boolean(activeGame);\n  const isPending = activeGame?.pending ?? false;\n  els.btnAnalyseWhite.disabled = !hasActive || isPending;\n  els.btnAnalyseBlack.disabled = !hasActive || isPending;\n  els.btnCopyFen.disabled = !hasActive;\n  els.btnCopyPgn.disabled = !hasActive;\n  els.btnSetOpening.disabled = !hasActive;\n  els.btnSelectText.disabled = !hasActive;\n  renderPositions(model, dispatch);\n  renderWorkflowPanels(model);\n  renderOverlayBoards(model);\n  renderDiagramOverlay(model, dispatch);\n  renderAnalysis(model, dispatch);\n  renderReachModal(model);\n  renderBoardRow(model, dispatch);\n};\n", "import type { Msg } from \"../core/msg\";\nimport type { Model } from \"../core/model\";\nimport { asPageNum } from \"../core/model\";\nimport { els } from \"./dom\";\n\ntype Dispatch = (msg: Msg) => void;\ntype GetModel = () => Model;\n\nexport const bindEvents = (dispatch: Dispatch, getModel: GetModel): void => {\n    els.btnOpen.addEventListener(\"click\", () => els.pdfInput.click());\n    els.btnCloseBoard.addEventListener(\"click\", () => dispatch({ tag: \"DiagramActivated\", gameId: null }));\n\n    // Debug: Add click handler directly on pdfPageContainer\n    els.pdfPageContainer.addEventListener(\"click\", (e) => {\n        const rect = els.pdfPageContainer.getBoundingClientRect();\n        const x = e.clientX - rect.left;\n        const y = e.clientY - rect.top;\n        console.log(\"[DEBUG] pdfPageContainer clicked at:\", x, y, \"target:\", e.target);\n    });\n    els.pdfInput.addEventListener(\"change\", () => {\n        const file = els.pdfInput.files?.[0];\n        if (!file) return;\n        dispatch({ tag: \"PdfFileSelected\", file });\n        els.pdfInput.value = \"\";\n    });\n    els.btnPrevPage.addEventListener(\"click\", () => {\n        const model = getModel();\n        if (model.pdf.currentPage > 1) {\n            dispatch({\n                tag: \"PageRequested\",\n                page: asPageNum((model.pdf.currentPage as number) - 1),\n            });\n        }\n    });\n    els.btnNextPage.addEventListener(\"click\", () => {\n        const model = getModel();\n        if (model.pdf.currentPage < model.pdf.totalPages) {\n            dispatch({\n                tag: \"PageRequested\",\n                page: asPageNum((model.pdf.currentPage as number) + 1),\n            });\n        }\n    });\n    els.btnGotoPage.addEventListener(\"click\", () => {\n        const model = getModel();\n        const next = Number.parseInt(els.pageInput.value, 10);\n        if (!Number.isFinite(next)) return;\n        dispatch({\n            tag: \"PageRequested\",\n            page: asPageNum(Math.min(Math.max(next, 1), model.pdf.totalPages)),\n        });\n    });\n    els.pageInput.addEventListener(\"keydown\", (event) => {\n        if (event.key === \"Enter\") {\n            els.btnGotoPage.click();\n        }\n    });\n    els.zoomSlider.addEventListener(\"input\", () => {\n        const value = Number.parseInt(els.zoomSlider.value, 10);\n        if (!Number.isFinite(value)) return;\n        dispatch({ tag: \"ZoomChanged\", scale: value / 100 });\n    });\n    els.btnConfirmPieces.addEventListener(\"click\", () => dispatch({ tag: \"ConfirmPieces\" }));\n    els.btnEditPieces.addEventListener(\"click\", () => dispatch({ tag: \"EditPieces\" }));\n    els.btnContinueGame.addEventListener(\"click\", () => dispatch({ tag: \"ContinueSelectedGame\" }));\n    els.btnNewGame.addEventListener(\"click\", () => dispatch({ tag: \"StartNewGame\" }));\n    els.btnReachOtb.addEventListener(\"click\", () => dispatch({ tag: \"ReachStartOtb\" }));\n    els.btnReachOcr.addEventListener(\"click\", () =>\n        dispatch({ tag: \"TextSelectModeChanged\", mode: \"ocr\" }),\n    );\n    els.btnStopOtb.addEventListener(\"click\", () => dispatch({ tag: \"ReachCancel\" }));\n    els.btnStartTextSelect.addEventListener(\"click\", () =>\n        dispatch({ tag: \"TextSelectModeChanged\", mode: \"overlay\" }),\n    );\n    els.btnToggleEngine.addEventListener(\"click\", () => dispatch({ tag: \"EngineToggle\" }));\n    els.btnAnalyseWhite.addEventListener(\"click\", () => {\n        const model = getModel();\n        const active = model.workflow.tag === \"VIEWING\" ? model.workflow.activeGameId : null;\n        if (active) {\n            dispatch({ tag: \"AnalysisStarted\", gameId: active, turn: \"w\" });\n        }\n    });\n    els.btnAnalyseBlack.addEventListener(\"click\", () => {\n        const model = getModel();\n        const active = model.workflow.tag === \"VIEWING\" ? model.workflow.activeGameId : null;\n        if (active) {\n            dispatch({ tag: \"AnalysisStarted\", gameId: active, turn: \"b\" });\n        }\n    });\n    els.btnCopyFen.addEventListener(\"click\", () => dispatch({ tag: \"CopyFen\" }));\n    els.btnCopyPgn.addEventListener(\"click\", () => dispatch({ tag: \"CopyPgn\" }));\n    els.btnSelectText.addEventListener(\"click\", () =>\n        dispatch({ tag: \"TextSelectModeChanged\", mode: \"overlay\" }),\n    );\n    els.btnSetOpening.addEventListener(\"click\", () =>\n        dispatch({ tag: \"OpeningsInputShown\", content: \"\" }),\n    );\n    els.btnApplyOpening.addEventListener(\"click\", () =>\n        dispatch({ tag: \"OpeningsInputHidden\" }),\n    );\n    els.btnCancelOpening.addEventListener(\"click\", () =>\n        dispatch({ tag: \"OpeningsInputHidden\" }),\n    );\n    els.reachBtnUndo.addEventListener(\"click\", () => dispatch({ tag: \"ReachUndo\" }));\n    els.reachBtnReset.addEventListener(\"click\", () => dispatch({ tag: \"ReachReset\" }));\n    els.reachBtnDone.addEventListener(\"click\", () => dispatch({ tag: \"ReachDone\" }));\n    els.reachBtnCancel.addEventListener(\"click\", () => dispatch({ tag: \"ReachCancel\" }));\n    els.reachModalClose.addEventListener(\"click\", () => dispatch({ tag: \"ReachCancel\" }));\n    const backdrop = document.querySelector(\".reach-modal-backdrop\");\n    if (backdrop) {\n        backdrop.addEventListener(\"click\", () => dispatch({ tag: \"ReachCancel\" }));\n    }\n\n    // Board row bindings - Confirm mode\n    els.btnRowConfirm.addEventListener(\"click\", () => dispatch({ tag: \"ConfirmPieces\" }));\n    els.btnRowEdit.addEventListener(\"click\", () => dispatch({ tag: \"EditPieces\" }));\n\n    // Board row bindings - Match mode\n    els.btnRowContinue.addEventListener(\"click\", () => dispatch({ tag: \"ContinueSelectedGame\" }));\n    els.btnRowNewGame.addEventListener(\"click\", () => dispatch({ tag: \"StartNewGame\" }));\n    els.matchGameSelect.addEventListener(\"change\", () => {\n        const selectedId = els.matchGameSelect.value;\n        if (selectedId) {\n            dispatch({ tag: \"MatchGameSelected\", gameId: selectedId as any });\n        }\n    });\n\n    // Board row bindings - Reach mode\n    els.btnRowUndo.addEventListener(\"click\", () => dispatch({ tag: \"ReachUndo\" }));\n    els.btnRowReset.addEventListener(\"click\", () => dispatch({ tag: \"ReachReset\" }));\n    els.btnRowDone.addEventListener(\"click\", () => dispatch({ tag: \"ReachDone\" }));\n    els.btnRowCancel.addEventListener(\"click\", () => dispatch({ tag: \"ReachCancel\" }));\n\n    // Board row bindings - Analysis mode\n    els.btnRowAnalyseWhite.addEventListener(\"click\", () => {\n        const model = getModel();\n        const active = model.workflow.tag === \"VIEWING\" ? model.workflow.activeGameId : null;\n        if (active) {\n            dispatch({ tag: \"AnalysisStarted\", gameId: active, turn: \"w\" });\n        }\n    });\n    els.btnRowAnalyseBlack.addEventListener(\"click\", () => {\n        const model = getModel();\n        const active = model.workflow.tag === \"VIEWING\" ? model.workflow.activeGameId : null;\n        if (active) {\n            dispatch({ tag: \"AnalysisStarted\", gameId: active, turn: \"b\" });\n        }\n    });\n    els.btnRowCopyFen.addEventListener(\"click\", () => dispatch({ tag: \"CopyFen\" }));\n    els.btnRowCopyPgn.addEventListener(\"click\", () => dispatch({ tag: \"CopyPgn\" }));\n    els.btnRowClose.addEventListener(\"click\", () => dispatch({ tag: \"DiagramActivated\", gameId: null }));\n\n    // Board row bindings - How to reach mode\n    els.btnRowOtb.addEventListener(\"click\", () => dispatch({ tag: \"ReachStartOtb\" }));\n    els.btnRowManual.addEventListener(\"click\", () => dispatch({ tag: \"ReachStartManual\" }))\n\n    document.addEventListener(\"keydown\", (event) => {\n        const target = event.target as HTMLElement | null;\n        if (target && (target.tagName === \"INPUT\" || target.tagName === \"TEXTAREA\")) {\n            return;\n        }\n        const model = getModel();\n        switch (event.key) {\n            case \"ArrowLeft\":\n                if (model.pdf.currentPage > 1) {\n                    dispatch({ tag: \"PageRequested\", page: asPageNum((model.pdf.currentPage as number) - 1) });\n                }\n                break;\n            case \"ArrowRight\":\n                if (model.pdf.currentPage < model.pdf.totalPages) {\n                    dispatch({ tag: \"PageRequested\", page: asPageNum((model.pdf.currentPage as number) + 1) });\n                }\n                break;\n            case \"Escape\":\n                dispatch({ tag: \"DiagramActivated\", gameId: null });\n                break;\n            case \"h\":\n                dispatch({ tag: \"AnalysisGoBack\" });\n                break;\n            case \"l\":\n                dispatch({ tag: \"AnalysisGoForward\" });\n                break;\n            case \"j\":\n                dispatch({ tag: \"AnalysisNextVariation\" });\n                break;\n            case \"k\":\n                dispatch({ tag: \"AnalysisPrevVariation\" });\n                break;\n            case \"x\":\n            case \"Delete\":\n            case \"Backspace\":\n                if (event.key === \"Backspace\" && !event.ctrlKey && !event.metaKey) {\n                    break;\n                }\n                dispatch({ tag: \"AnalysisDeleteVariation\" });\n                event.preventDefault();\n                break;\n            default:\n                break;\n        }\n    });\n};\n", "import type { Msg } from \"../core/msg\";\nimport type { ChessboardInstance } from \"./adapters/chessboard\";\nimport { els } from \"./dom\";\n\ntype Dispatch = (msg: Msg) => void;\ntype GetPreviewBoard = () => ChessboardInstance | null;\ntype IsEditable = () => boolean;\n\nlet selectedPiece: string | null = null;\n\nconst pieceTheme = \"/static/vendor/img/chesspieces/wikipedia/{piece}.png\";\n\nconst createPieceImg = (piece: string, dispatch: Dispatch): HTMLImageElement => {\n  const img = document.createElement(\"img\");\n  img.src = pieceTheme.replace(\"{piece}\", piece);\n  img.draggable = true;\n  img.dataset.piece = piece;\n  img.className = \"palette-piece\";\n  img.addEventListener(\"dragstart\", (event) => {\n    event.dataTransfer?.setData(\"piece\", piece);\n    event.dataTransfer?.setData(\"text/plain\", piece);\n    if (event.dataTransfer) {\n      event.dataTransfer.effectAllowed = \"copy\";\n    }\n  });\n  img.addEventListener(\"click\", () => {\n    document.querySelectorAll(\".palette-piece.selected\").forEach((el) => {\n      el.classList.remove(\"selected\");\n    });\n    if (selectedPiece === piece) {\n      selectedPiece = null;\n      dispatch({ tag: \"Status\", message: \"Piece deselected\" });\n    } else {\n      selectedPiece = piece;\n      img.classList.add(\"selected\");\n      dispatch({\n        tag: \"Status\",\n        message: `Selected ${piece} - click on board to place, or click piece again to deselect`,\n      });\n    }\n  });\n  return img;\n};\n\nconst getSquareFromEvent = (event: MouseEvent): string | null => {\n  const boardEl = document.getElementById(\"active-board\");\n  if (!boardEl) return null;\n  const rect = boardEl.getBoundingClientRect();\n  const x = event.clientX - rect.left;\n  const y = event.clientY - rect.top;\n  if (x < 0 || y < 0 || x > rect.width || y > rect.height) return null;\n  const squareSize = rect.width / 8;\n  const file = Math.floor(x / squareSize);\n  const rank = 7 - Math.floor(y / squareSize);\n  if (file < 0 || file > 7 || rank < 0 || rank > 7) return null;\n  const files = \"abcdefgh\";\n  return `${files[file]}${rank + 1}`;\n};\n\nconst placePieceOnSquare = (\n  board: ChessboardInstance,\n  piece: string,\n  square: string,\n  dispatch: Dispatch,\n): void => {\n  const current = board.position();\n  current[square] = piece;\n  board.position(current, false);\n  dispatch({ tag: \"Status\", message: `Placed ${piece} on ${square}` });\n};\n\nconst removePieceFromSquare = (\n  board: ChessboardInstance,\n  square: string,\n  dispatch: Dispatch,\n): void => {\n  const current = board.position();\n  if (!current[square]) {\n    dispatch({ tag: \"Status\", message: `No piece on ${square}` });\n    return;\n  }\n  const piece = current[square];\n  delete current[square];\n  board.position(current, false);\n  dispatch({ tag: \"Status\", message: `Removed ${piece} from ${square}` });\n};\n\nexport const setupPiecePalettes = (\n  dispatch: Dispatch,\n  getPreviewBoard: GetPreviewBoard,\n  isEditable: IsEditable,\n): void => {\n  const blackPieces = [\"bK\", \"bQ\", \"bR\", \"bB\", \"bN\", \"bP\"];\n  const whitePieces = [\"wK\", \"wQ\", \"wR\", \"wB\", \"wN\", \"wP\"];\n  els.paletteBlack.innerHTML = \"\";\n  els.paletteWhite.innerHTML = \"\";\n  blackPieces.forEach((piece) => els.paletteBlack.appendChild(createPieceImg(piece, dispatch)));\n  whitePieces.forEach((piece) => els.paletteWhite.appendChild(createPieceImg(piece, dispatch)));\n\n  els.boardOverlay.addEventListener(\"dragover\", (event) => {\n    console.log(\"[PALETTE] dragover on boardOverlay\");\n    event.preventDefault();\n    if (event.dataTransfer) {\n      event.dataTransfer.dropEffect = \"copy\";\n    }\n  });\n  els.boardOverlay.addEventListener(\"drop\", (event) => {\n    console.log(\"[PALETTE] drop on boardOverlay, piece:\", event.dataTransfer?.getData(\"piece\"));\n    event.preventDefault();\n    if (!isEditable()) {\n      dispatch({ tag: \"Status\", message: \"Cannot edit board during analysis\" });\n      return;\n    }\n    const board = getPreviewBoard();\n    if (!board) {\n      console.log(\"[PALETTE] no board available\");\n      return;\n    }\n    const piece = event.dataTransfer?.getData(\"piece\");\n    if (!piece) {\n      console.log(\"[PALETTE] no piece in dataTransfer\");\n      return;\n    }\n    const square = getSquareFromEvent(event);\n    if (!square) {\n      console.log(\"[PALETTE] could not determine square from event\");\n      return;\n    }\n    console.log(\"[PALETTE] placing\", piece, \"on\", square);\n    placePieceOnSquare(board, piece, square, dispatch);\n  });\n  els.boardOverlay.addEventListener(\"click\", (event) => {\n    console.log(\"[PALETTE] click on boardOverlay, selectedPiece:\", selectedPiece);\n    if (!selectedPiece) return;\n    if (!isEditable()) {\n      dispatch({ tag: \"Status\", message: \"Cannot edit board during analysis\" });\n      return;\n    }\n    const board = getPreviewBoard();\n    if (!board) {\n      console.log(\"[PALETTE] no board for click\");\n      return;\n    }\n    const square = getSquareFromEvent(event);\n    if (!square) {\n      console.log(\"[PALETTE] no square from click event\");\n      return;\n    }\n    console.log(\"[PALETTE] placing\", selectedPiece, \"on\", square, \"via click\");\n    placePieceOnSquare(board, selectedPiece, square, dispatch);\n    selectedPiece = null;\n    document.querySelectorAll(\".palette-piece.selected\").forEach((el) => {\n      el.classList.remove(\"selected\");\n    });\n  });\n  els.boardOverlay.addEventListener(\"contextmenu\", (event) => {\n    event.preventDefault();\n    if (!isEditable()) {\n      dispatch({ tag: \"Status\", message: \"Cannot edit board during analysis\" });\n      return;\n    }\n    const board = getPreviewBoard();\n    if (!board) return;\n    const square = getSquareFromEvent(event);\n    if (!square) return;\n    removePieceFromSquare(board, square, dispatch);\n  });\n};\n", "import type { Msg } from \"../core/msg\";\nimport type { Model } from \"../core/model\";\nimport { cssToPdfBBox, bbox } from \"../domain/pdf/bbox\";\nimport { asCssPx } from \"../core/model\";\nimport { toPageIndex } from \"../domain/pdf/page\";\nimport { els } from \"./dom\";\n\ntype Dispatch = (msg: Msg) => void;\ntype GetModel = () => Model;\n\ntype DragState = {\n  startX: number;\n  startY: number;\n  rect: SVGRectElement;\n  mode: \"text\" | \"manual\";\n};\n\nlet dragState: DragState | null = null;\n\nconst createRect = (x: number, y: number, className: string): SVGRectElement => {\n  const rect = document.createElementNS(\"http://www.w3.org/2000/svg\", \"rect\");\n  rect.setAttribute(\"x\", String(x));\n  rect.setAttribute(\"y\", String(y));\n  rect.setAttribute(\"width\", \"0\");\n  rect.setAttribute(\"height\", \"0\");\n  rect.classList.add(className);\n  return rect;\n};\n\nconst updateRect = (state: DragState, x: number, y: number): void => {\n  const width = Math.abs(x - state.startX);\n  const height = state.mode === \"manual\" ? width : Math.abs(y - state.startY);\n  const left = Math.min(state.startX, x);\n  const top = state.mode === \"manual\" ? Math.min(state.startY, state.startY + (y > state.startY ? height : -height)) : Math.min(state.startY, y);\n  state.rect.setAttribute(\"x\", String(left));\n  state.rect.setAttribute(\"y\", String(top));\n  state.rect.setAttribute(\"width\", String(width));\n  state.rect.setAttribute(\"height\", String(height));\n};\n\nexport const bindManualSelection = (dispatch: Dispatch, getModel: GetModel): void => {\n  const getLocalPoint = (event: MouseEvent): { x: number; y: number } => {\n    const rect = els.detectionOverlay.getBoundingClientRect();\n    return { x: event.clientX - rect.left, y: event.clientY - rect.top };\n  };\n\n  els.detectionOverlay.addEventListener(\"mousedown\", (event) => {\n    const model = getModel();\n    if (!model.pdf.id) return;\n\n    // Don't start a new selection if clicking on an existing detection box\n    const target = event.target as Element;\n    if (target.classList.contains(\"detection-box\") || target.classList.contains(\"resize-handle\")) {\n      return;\n    }\n\n    const { x, y } = getLocalPoint(event);\n    if (model.ui.textSelectMode) {\n      const rect = createRect(x, y, \"text-select-box\");\n      els.detectionOverlay.appendChild(rect);\n      dragState = { startX: x, startY: y, rect, mode: \"text\" };\n      return;\n    }\n    const rect = createRect(x, y, \"detection-box\");\n    rect.classList.add(\"drawing\");\n    rect.style.strokeDasharray = \"5,5\";\n    els.detectionOverlay.appendChild(rect);\n    dragState = { startX: x, startY: y, rect, mode: \"manual\" };\n  });\n\n  els.detectionOverlay.addEventListener(\"mousemove\", (event) => {\n    if (!dragState) return;\n    const { x, y } = getLocalPoint(event);\n    updateRect(dragState, x, y);\n  });\n\n  const endSelection = (event: MouseEvent) => {\n    if (!dragState) return;\n    const model = getModel();\n    const rect = dragState.rect;\n    const width = Number.parseFloat(rect.getAttribute(\"width\") ?? \"0\");\n    const height = Number.parseFloat(rect.getAttribute(\"height\") ?? \"0\");\n    const minSize = dragState.mode === \"text\" ? 20 : 50;\n    if (width < minSize || height < minSize) {\n      rect.remove();\n      dragState = null;\n      dispatch({ tag: \"TextSelectModeChanged\", mode: null });\n      return;\n    }\n    const cssBox = bbox(\n      asCssPx(Number.parseFloat(rect.getAttribute(\"x\") ?? \"0\")),\n      asCssPx(Number.parseFloat(rect.getAttribute(\"y\") ?? \"0\")),\n      asCssPx(width),\n      asCssPx(height),\n    );\n    rect.remove();\n    if (dragState.mode === \"text\") {\n      dispatch({ tag: \"TextSelectModeChanged\", mode: null });\n      if (model.pdf.id) {\n        dispatch({\n          tag: \"ExtractMovesRequested\",\n          page: toPageIndex(model.pdf.currentPage),\n          bbox: cssToPdfBBox(cssBox, model.pdf.scale),\n        });\n      }\n    } else {\n      const diagrams = model.diagrams?.diagrams ?? [];\n      const updated = [...diagrams, cssToPdfBBox(cssBox, model.pdf.scale)];\n      dispatch({ tag: \"DiagramsDetected\", page: model.pdf.currentPage, diagrams: updated });\n      dispatch({ tag: \"Status\", message: \"Click on the box to recognize the position\" });\n    }\n    dragState = null;\n  };\n\n  els.detectionOverlay.addEventListener(\"mouseup\", endSelection);\n  els.detectionOverlay.addEventListener(\"mouseleave\", endSelection);\n};\n", "export type Result<T, E> =\n  | { ok: true; value: T }\n  | { ok: false; error: E };\n\nexport const ok = <T>(value: T): Result<T, never> => ({ ok: true, value });\nexport const err = <E>(error: E): Result<never, E> => ({ ok: false, error });\n\nexport const map = <T, U, E>(res: Result<T, E>, fn: (value: T) => U): Result<U, E> =>\n  res.ok ? ok(fn(res.value)) : res;\n\nexport const mapError = <T, E, F>(res: Result<T, E>, fn: (error: E) => F): Result<T, F> =>\n  res.ok ? res : err(fn(res.error));\n\nexport const andThen = <T, U, E>(\n  res: Result<T, E>,\n  fn: (value: T) => Result<U, E>,\n): Result<U, E> => (res.ok ? fn(res.value) : res);\n\nexport const toPromise = <T, E>(res: Result<T, E>): Promise<T> =>\n  res.ok ? Promise.resolve(res.value) : Promise.reject(res.error);\n", "import type { Result } from \"../core/result\";\nimport { err, ok } from \"../core/result\";\nimport type {\n  ContentHash,\n  Game,\n  GameId,\n  PdfId,\n  Study,\n} from \"../core/model\";\nimport {\n  asContentHash,\n  asGameId,\n  asPageNum,\n  asPdfId,\n  asPdfPx,\n} from \"../core/model\";\nimport type { FenPlacement } from \"../domain/chess/fen\";\nimport { asFenPlacement } from \"../domain/chess/fen\";\nimport type { AnalysisTreeJson } from \"../domain/chess/analysisTree\";\nimport { analysisTreeFromJSON, analysisTreeToJSON } from \"../domain/chess/analysisTree\";\nimport type { San } from \"../domain/chess/san\";\nimport { asSan } from \"../domain/chess/san\";\nimport type { PdfBBox } from \"../domain/pdf/bbox\";\nimport { bbox } from \"../domain/pdf/bbox\";\n\ntype PdfInfo = Readonly<{\n  pdfId: PdfId;\n  contentHash: ContentHash;\n  filename: string;\n  pages: number;\n  hasStudy: boolean;\n}>;\n\ntype CheckPdfResult = Readonly<{ exists: false } | { exists: true; info: PdfInfo }>;\n\ntype RecognizeResult = Readonly<{ placement: FenPlacement; confidence: number }>;\n\ntype ExtractMovesResult = Readonly<{ pdfText: string; ocrText: string }>;\n\nconst isRecord = (value: unknown): value is Record<string, unknown> =>\n  typeof value === \"object\" && value !== null;\n\nconst getString = (value: unknown): string | null =>\n  typeof value === \"string\" ? value : null;\n\nconst getNumber = (value: unknown): number | null =>\n  typeof value === \"number\" && Number.isFinite(value) ? value : null;\n\nconst decodePdfInfo = (data: Record<string, unknown>, filenameOverride?: string): Result<PdfInfo, string> => {\n  const pdfId = getString(data.pdf_id);\n  const contentHash = getString(data.content_hash) ?? pdfId;\n  const pages = getNumber(data.pages);\n  const filename = filenameOverride ?? getString(data.filename);\n  const hasStudy = typeof data.has_study === \"boolean\" ? data.has_study : false;\n  if (!pdfId || !contentHash || pages === null || !filename) {\n    return err(\"Invalid PDF info response\");\n  }\n  return ok({\n    pdfId: asPdfId(pdfId),\n    contentHash: asContentHash(contentHash),\n    filename,\n    pages,\n    hasStudy,\n  });\n};\n\nconst decodePdfBBox = (data: Record<string, unknown>): Result<PdfBBox, string> => {\n  const x = getNumber(data.x);\n  const y = getNumber(data.y);\n  const width = getNumber(data.width);\n  const height = getNumber(data.height);\n  if (x === null || y === null || width === null || height === null) {\n    return err(\"Invalid bbox\");\n  }\n  return ok(bbox(asPdfPx(x), asPdfPx(y), asPdfPx(width), asPdfPx(height)));\n};\n\nexport const checkPdf = async (contentHash: ContentHash): Promise<Result<CheckPdfResult, string>> => {\n  try {\n    const response = await fetch(`/api/check-pdf/${contentHash}`);\n    if (!response.ok) {\n      if (response.status === 404) {\n        return ok({ exists: false });\n      }\n      const errorData = (await response.json().catch(() => null)) as unknown;\n      if (isRecord(errorData) && typeof errorData.error === \"string\") {\n        return err(errorData.error);\n      }\n      return err(\"Failed to check PDF\");\n    }\n    const data = (await response.json()) as unknown;\n    if (!isRecord(data)) {\n      return err(\"Invalid response\");\n    }\n    const decoded = decodePdfInfo(data);\n    if (!decoded.ok) return decoded;\n    return ok({ exists: true, info: decoded.value });\n  } catch (error) {\n    return err(String(error));\n  }\n};\n\nexport const uploadPdf = async (\n  file: File,\n  _contentHash: ContentHash,\n): Promise<Result<PdfInfo, string>> => {\n  try {\n    const formData = new FormData();\n    formData.append(\"file\", file);\n    const response = await fetch(\"/api/upload-pdf\", {\n      method: \"POST\",\n      body: formData,\n    });\n    const data = (await response.json()) as unknown;\n    if (!response.ok) {\n      if (isRecord(data) && typeof data.error === \"string\") {\n        return err(data.error);\n      }\n      return err(\"Failed to upload PDF\");\n    }\n    if (!isRecord(data)) {\n      return err(\"Invalid response\");\n    }\n    return decodePdfInfo(data, file.name);\n  } catch (error) {\n    return err(String(error));\n  }\n};\n\nexport const detectDiagrams = async (\n  pdfId: PdfId,\n  pageIndex: number,\n): Promise<Result<ReadonlyArray<PdfBBox>, string>> => {\n  try {\n    const response = await fetch(`/api/detect-diagrams/${pdfId}/${pageIndex}`);\n    const data = (await response.json()) as unknown;\n    if (!response.ok) {\n      if (isRecord(data) && typeof data.error === \"string\") {\n        return err(data.error);\n      }\n      return err(\"Failed to detect diagrams\");\n    }\n    if (!isRecord(data) || !Array.isArray(data.diagrams)) {\n      return err(\"Invalid diagrams response\");\n    }\n    const boxes: PdfBBox[] = [];\n    for (const item of data.diagrams) {\n      if (!isRecord(item)) {\n        return err(\"Invalid bbox\");\n      }\n      const decoded = decodePdfBBox(item);\n      if (!decoded.ok) {\n        return err(decoded.error);\n      }\n      boxes.push(decoded.value);\n    }\n    return ok(boxes);\n  } catch (error) {\n    return err(String(error));\n  }\n};\n\nexport const recognizeRegion = async (\n  pdfId: PdfId,\n  pageIndex: number,\n  bbox: PdfBBox,\n): Promise<Result<RecognizeResult, string>> => {\n  try {\n    const response = await fetch(\"/api/recognize-region\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({\n        pdf_id: pdfId,\n        page: pageIndex,\n        bbox: {\n          x: bbox.x,\n          y: bbox.y,\n          width: bbox.width,\n          height: bbox.height,\n        },\n      }),\n    });\n    const data = (await response.json()) as unknown;\n    if (!response.ok) {\n      if (isRecord(data) && typeof data.error === \"string\") {\n        return err(data.error);\n      }\n      return err(\"Recognition failed\");\n    }\n    if (!isRecord(data)) return err(\"Invalid response\");\n    const fen = getString(data.fen);\n    const confidence = getNumber(data.confidence);\n    if (!fen || confidence === null) {\n      return err(\"Invalid recognition response\");\n    }\n    return ok({ placement: asFenPlacement(fen), confidence });\n  } catch (error) {\n    return err(String(error));\n  }\n};\n\nexport const extractMoves = async (\n  pdfId: PdfId,\n  pageIndex: number,\n  bbox: PdfBBox,\n): Promise<Result<ExtractMovesResult, string>> => {\n  try {\n    const response = await fetch(\"/api/extract-moves\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({\n        pdf_id: pdfId,\n        page: pageIndex,\n        bbox: {\n          x: bbox.x,\n          y: bbox.y,\n          width: bbox.width,\n          height: bbox.height,\n        },\n      }),\n    });\n    const data = (await response.json()) as unknown;\n    if (!response.ok) {\n      if (isRecord(data) && typeof data.error === \"string\") {\n        return err(data.error);\n      }\n      return err(\"Failed to extract moves\");\n    }\n    if (!isRecord(data)) return err(\"Invalid response\");\n    const pdfText = getString(data.pdf_text) ?? \"\";\n    const ocrText = getString(data.ocr_text) ?? \"\";\n    return ok({ pdfText, ocrText });\n  } catch (error) {\n    return err(String(error));\n  }\n};\n\nexport const saveStudy = async (pdfId: PdfId, study: Study): Promise<Result<void, string>> => {\n  try {\n    const response = await fetch(\"/api/save-study\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({\n        pdf_id: pdfId,\n        study: serializeStudy(study),\n      }),\n    });\n    const data = (await response.json()) as unknown;\n    if (!response.ok) {\n      if (isRecord(data) && typeof data.error === \"string\") {\n        return err(data.error);\n      }\n      return err(\"Failed to save study\");\n    }\n    return ok(undefined);\n  } catch (error) {\n    return err(String(error));\n  }\n};\n\nexport const loadStudy = async (pdfId: PdfId): Promise<Result<Study | null, string>> => {\n  try {\n    const response = await fetch(`/api/load-study/${pdfId}`);\n    if (!response.ok) {\n      if (response.status === 404) {\n        return ok(null);\n      }\n    }\n    const data = (await response.json()) as unknown;\n    if (!response.ok) {\n      if (isRecord(data) && typeof data.error === \"string\") {\n        return err(data.error);\n      }\n      return err(\"Failed to load study\");\n    }\n    if (!isRecord(data)) return err(\"Invalid response\");\n    if (data.exists !== true || !isRecord(data.study)) {\n      return ok(null);\n    }\n    return decodeStudy(data.study);\n  } catch (error) {\n    return err(String(error));\n  }\n};\n\nconst serializeStudy = (study: Study): Record<string, unknown> => ({\n  games: study.games.filter((game) => !game.pending).map((game) => ({\n    id: game.id,\n    page: game.page,\n    bbox: game.bbox,\n    fen: game.fen,\n    confidence: game.confidence,\n    pending: game.pending,\n  })),\n  analyses: Object.fromEntries(\n    Object.entries(study.analyses).map(([id, tree]) => [id, analysisTreeToJSON(tree)]),\n  ),\n  continuations: study.continuations,\n});\n\nconst decodeStudy = (data: Record<string, unknown>): Result<Study, string> => {\n  if (!Array.isArray(data.games)) {\n    return err(\"Invalid study games\");\n  }\n  const games: Game[] = [];\n  for (const entry of data.games) {\n    if (!isRecord(entry)) {\n      return err(\"Invalid game entry\");\n    }\n    const id = getString(entry.id);\n    const page = getNumber(entry.page);\n    const bboxEntry = entry.bbox;\n    const fen = getString(entry.fen);\n    const confidence = getNumber(entry.confidence) ?? 0;\n    const pending = typeof entry.pending === \"boolean\" ? entry.pending : false;\n    if (!id || page === null || !fen || !isRecord(bboxEntry)) {\n      return err(\"Invalid game data\");\n    }\n    const bboxDecoded = decodePdfBBox(bboxEntry);\n    if (!bboxDecoded.ok) {\n      return err(bboxDecoded.error);\n    }\n    games.push({\n      id: asGameId(id),\n      page: asPageNum(page),\n      bbox: bboxDecoded.value,\n      fen: asFenPlacement(fen),\n      confidence,\n      pending,\n    });\n  }\n  const analyses: Record<GameId, import(\"../domain/chess/analysisTree\").AnalysisTree> = {};\n  if (isRecord(data.analyses)) {\n    for (const [id, treeData] of Object.entries(data.analyses)) {\n      if (isRecord(treeData)) {\n        analyses[asGameId(id)] = analysisTreeFromJSON(treeData as AnalysisTreeJson);\n      }\n    }\n  }\n  const continuations: Record<GameId, { analysisId: GameId; nodePath: ReadonlyArray<San> }> = {};\n  if (isRecord(data.continuations)) {\n    for (const [id, linkData] of Object.entries(data.continuations)) {\n      if (isRecord(linkData)) {\n        const analysisId = getString(linkData.analysisId);\n        const nodePath = Array.isArray(linkData.nodePath)\n          ? linkData.nodePath.map((san) => asSanSafe(san))\n          : [];\n        if (analysisId) {\n          continuations[asGameId(id)] = {\n            analysisId: asGameId(analysisId),\n            nodePath,\n          };\n        }\n      }\n    }\n  }\n  return ok({ games, analyses, continuations });\n};\nconst asSanSafe = (value: unknown): San => (typeof value === \"string\" ? asSan(value) : asSan(\"\"));\n", "import type { Result } from \"../core/result\";\nimport { err, ok } from \"../core/result\";\nimport type { FenFull, FenPlacement } from \"../domain/chess/fen\";\nimport { asFenFull } from \"../domain/chess/fen\";\n\nexport type BoardStatus = Readonly<{\n  available: boolean;\n  connected: boolean;\n}>;\n\nexport type SyncResult = Readonly<{\n  synced: boolean;\n  driverSynced: boolean;\n  error?: string;\n}>;\n\nconst isRecord = (value: unknown): value is Record<string, unknown> =>\n  typeof value === \"object\" && value !== null;\n\nexport const setFen = async (\n  fen: FenPlacement,\n  force: boolean,\n): Promise<Result<SyncResult, string>> => {\n  try {\n    const response = await fetch(\"/api/board/set-fen\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({ fen, force }),\n    });\n    const data = (await response.json()) as unknown;\n    if (!response.ok) {\n      if (isRecord(data) && typeof data.error === \"string\") {\n        return err(data.error);\n      }\n      return err(\"Failed to sync board\");\n    }\n    if (!isRecord(data)) return err(\"Invalid board response\");\n    return ok({\n      synced: Boolean(data.synced),\n      driverSynced: Boolean(data.driver_synced),\n      error: typeof data.error === \"string\" ? data.error : undefined,\n    });\n  } catch (error) {\n    return err(String(error));\n  }\n};\n\nexport const fetchStatus = async (): Promise<Result<BoardStatus, string>> => {\n  try {\n    const response = await fetch(\"/api/board/status\", {\n      method: \"GET\",\n      signal: AbortSignal.timeout(2000),\n    });\n    const data = (await response.json()) as unknown;\n    if (!response.ok) {\n      return err(\"Board status unavailable\");\n    }\n    if (!isRecord(data)) return err(\"Invalid board status\");\n    return ok({\n      available: Boolean(data.available),\n      connected: Boolean(data.connected),\n    });\n  } catch (error) {\n    return err(String(error));\n  }\n};\n\nexport const fetchFen = async (): Promise<Result<FenFull, string>> => {\n  try {\n    const response = await fetch(\"/api/board/fen\");\n    const data = (await response.json()) as unknown;\n    if (!response.ok) {\n      return err(\"Board fen unavailable\");\n    }\n    if (!isRecord(data) || typeof data.fen !== \"string\") {\n      return err(\"Invalid board fen\");\n    }\n    return ok(asFenFull(data.fen));\n  } catch (error) {\n    return err(String(error));\n  }\n};\n", "import type { Result } from \"../core/result\";\nimport { err, ok } from \"../core/result\";\nimport type { PageNum, PdfId } from \"../core/model\";\n\nexport type PdfResources = {\n  doc: PDFDocumentProxy | null;\n  renderTask: PDFRenderTask | null;\n};\n\nexport type RenderTarget = Readonly<{\n  canvas: HTMLCanvasElement;\n  overlay: SVGSVGElement;\n  viewportContainer: HTMLElement;\n}>;\n\nexport type RenderResult = Readonly<{\n  scale: number;\n  initialScaleSet: boolean;\n}>;\n\nexport const loadPdf = async (pdfId: PdfId): Promise<Result<PDFDocumentProxy, string>> => {\n  try {\n    const pdfUrl = `/api/pdf/${pdfId}`;\n    const doc = await pdfjsLib.getDocument(pdfUrl).promise;\n    return ok(doc);\n  } catch (error) {\n    return err(String(error));\n  }\n};\n\nexport const renderPage = async (\n  resources: PdfResources,\n  target: RenderTarget,\n  pageNum: PageNum,\n  scale: number,\n  initialScaleSet: boolean,\n): Promise<Result<RenderResult, string>> => {\n  if (!resources.doc) {\n    return err(\"PDF not loaded\");\n  }\n  if (resources.renderTask) {\n    try {\n      resources.renderTask.cancel();\n    } catch {\n      // ignore\n    }\n    resources.renderTask = null;\n  }\n  try {\n    const page = await resources.doc.getPage(pageNum as number);\n    let nextScale = scale;\n    let nextInitialScaleSet = initialScaleSet;\n    if (!initialScaleSet) {\n      const containerWidth = target.viewportContainer.clientWidth - 40;\n      const defaultViewport = page.getViewport({ scale: 1.0 });\n      const fitWidthScale = containerWidth / defaultViewport.width;\n      nextScale = Math.min(fitWidthScale, 1.5);\n      nextInitialScaleSet = true;\n    }\n    const viewport = page.getViewport({ scale: nextScale * 2 });\n    const ctx = target.canvas.getContext(\"2d\");\n    if (!ctx) {\n      return err(\"Canvas context unavailable\");\n    }\n    target.canvas.width = viewport.width;\n    target.canvas.height = viewport.height;\n    target.canvas.style.width = `${viewport.width / 2}px`;\n    target.canvas.style.height = `${viewport.height / 2}px`;\n    target.overlay.setAttribute(\"width\", String(viewport.width / 2));\n    target.overlay.setAttribute(\"height\", String(viewport.height / 2));\n    target.overlay.style.width = `${viewport.width / 2}px`;\n    target.overlay.style.height = `${viewport.height / 2}px`;\n    resources.renderTask = page.render({ canvasContext: ctx, viewport });\n    try {\n      await resources.renderTask.promise;\n    } catch (error) {\n      if ((error as Error).name !== \"RenderingCancelledException\") {\n        return err(String(error));\n      }\n    } finally {\n      resources.renderTask = null;\n    }\n    return ok({ scale: nextScale, initialScaleSet: nextInitialScaleSet });\n  } catch (error) {\n    return err(String(error));\n  }\n};\n", "import type { FenFull } from \"../domain/chess/fen\";\n\nexport type StockfishHandle = {\n  worker: Worker;\n};\n\nexport type EngineInfo = Readonly<{\n  evalText: string;\n  pv: string;\n}>;\n\nconst parseScore = (line: string): string | null => {\n  const match = line.match(/score (cp|mate) (-?\\d+)/);\n  if (!match) return null;\n  const type = match[1];\n  const value = Number.parseInt(match[2], 10);\n  if (Number.isNaN(value)) return null;\n  if (type === \"cp\") {\n    const evalText = (value / 100).toFixed(2);\n    return value >= 0 ? `+${evalText}` : evalText;\n  }\n  return value >= 0 ? `M${value}` : `-M${Math.abs(value)}`;\n};\n\nconst parsePv = (line: string): string | null => {\n  const match = line.match(/pv (.+)/);\n  if (!match) return null;\n  return match[1].split(\" \").slice(0, 8).join(\" \");\n};\n\nexport const createStockfish = (onInfo: (info: EngineInfo) => void): StockfishHandle | null => {\n  try {\n    const worker = new Worker(\"/static/js/stockfish-worker.js\");\n    worker.onmessage = (event) => {\n      const line = String(event.data ?? \"\");\n      if (line.startsWith(\"info\") && line.includes(\"score\")) {\n        const evalText = parseScore(line);\n        const pv = parsePv(line);\n        if (evalText || pv) {\n          onInfo({ evalText: evalText ?? \"-\", pv: pv ?? \"-\" });\n        }\n      }\n    };\n    worker.postMessage(\"uci\");\n    worker.postMessage(\"isready\");\n    return { worker };\n  } catch {\n    return null;\n  }\n};\n\nexport const startEngine = (engine: StockfishHandle): void => {\n  engine.worker.postMessage(\"uci\");\n  engine.worker.postMessage(\"isready\");\n};\n\nexport const stopEngine = (engine: StockfishHandle): void => {\n  engine.worker.postMessage(\"stop\");\n};\n\nexport const analyze = (engine: StockfishHandle, fen: FenFull, depth: number): void => {\n  engine.worker.postMessage(`position fen ${fen}`);\n  engine.worker.postMessage(`go depth ${depth}`);\n};\n", "import type { FenPlacement, FenFull } from \"../../domain/chess/fen\";\nimport { asFenPlacement } from \"../../domain/chess/fen\";\n\nexport type ChessboardInstance = {\n  destroy(): void;\n  position(position?: string | Record<string, string>, animate?: boolean): Record<string, string>;\n  resize(): void;\n};\n\nexport type ChessboardConfig = {\n  position: string;\n  draggable: boolean;\n  showNotation: boolean;\n  pieceTheme: string;\n  onDragStart?: (...args: unknown[]) => boolean | void;\n  onDrop?: (...args: unknown[]) => string | void;\n  onSnapEnd?: (...args: unknown[]) => void;\n  [key: string]: unknown;\n};\n\nexport const createBoard = (elementId: string, config: ChessboardConfig): ChessboardInstance =>\n  Chessboard(elementId, config) as ChessboardInstance;\n\nexport const setBoardPosition = (board: ChessboardInstance, fen: FenFull | FenPlacement): void => {\n  board.position(String(fen), false);\n};\n\nexport const getBoardFen = (board: ChessboardInstance): FenPlacement => {\n  const position = board.position();\n  return asFenPlacement(Chessboard.objToFen(position));\n};\n", "import type { Cmd } from \"./cmd\";\nimport type { Msg } from \"./msg\";\nimport type { Model, Study } from \"./model\";\nimport { asContentHash, asGameId } from \"./model\";\nimport { update } from \"./update\";\nimport { render } from \"../ui/render\";\nimport { bindEvents } from \"../ui/bindings\";\nimport { els } from \"../ui/dom\";\nimport { setupPiecePalettes } from \"../ui/palette\";\nimport { bindManualSelection } from \"../ui/selection\";\nimport { getActiveGame, getAnalysisNodeFen } from \"./selectors\";\nimport { detectDiagrams, extractMoves, loadStudy, recognizeRegion, saveStudy, uploadPdf } from \"../ports/api\";\nimport { checkPdf } from \"../ports/api\";\nimport { fetchFen, fetchStatus, setFen } from \"../ports/chessnut\";\nimport { loadPdf, renderPage } from \"../ports/pdfjs\";\nimport { createStockfish, analyze, startEngine, stopEngine } from \"../ports/stockfish\";\nimport { asFenFull } from \"../domain/chess/fen\";\nimport { asSan } from \"../domain/chess/san\";\nimport { toPageNum } from \"../domain/pdf/page\";\nimport type { PdfResources } from \"../ports/pdfjs\";\nimport type { ChessboardInstance } from \"../ui/adapters/chessboard\";\nimport { createBoard, getBoardFen } from \"../ui/adapters/chessboard\";\n\ntype Resources = {\n  pdf: PdfResources;\n  previewBoard: ChessboardInstance | null;\n  previewMode: \"analysis\" | \"preview\" | null;\n  analysisGame: Chess | null;\n  reachGame: Chess | null;\n  reachBoards: {\n    start: ChessboardInstance | null;\n    entry: ChessboardInstance | null;\n    target: ChessboardInstance | null;\n  };\n  // Board row boards\n  boardRow: {\n    before: ChessboardInstance | null;\n    now: ChessboardInstance | null;\n    after: ChessboardInstance | null;\n    nowGame: Chess | null;  // For interactive now board\n    currentMode: string | null;  // Track current mode to detect changes\n  };\n  stockfish: ReturnType<typeof createStockfish> | null;\n  boardStatusTimer: number | null;\n  chessnutPollTimer: number | null;\n  saveTimer: number | null;\n};\n\nconst createResources = (): Resources => ({\n  pdf: { doc: null, renderTask: null },\n  previewBoard: null,\n  previewMode: null,\n  analysisGame: null,\n  reachGame: null,\n  reachBoards: { start: null, entry: null, target: null },\n  boardRow: { before: null, now: null, after: null, nowGame: null, currentMode: null },\n  stockfish: null,\n  boardStatusTimer: null,\n  chessnutPollTimer: null,\n  saveTimer: null,\n});\n\nconst hashFile = async (file: File): Promise<string> => {\n  const buffer = await file.arrayBuffer();\n  const hashBuffer = await crypto.subtle.digest(\"SHA-256\", buffer);\n  const hashArray = Array.from(new Uint8Array(hashBuffer));\n  const hashHex = hashArray.map((b) => b.toString(16).padStart(2, \"0\")).join(\"\");\n  return hashHex.substring(0, 16);\n};\n\nconst buildStudy = (model: Model): Study => ({\n  games: model.games,\n  analyses: model.analyses,\n  continuations: model.continuations,\n});\n\nexport const createRuntime = (initial: Model) => {\n  let model = initial;\n  const resources = createResources();\n\n  const getModel = () => model;\n\n  const dispatch = (msg: Msg): void => {\n    const [next, cmds] = update(model, msg);\n    model = next;\n    render(model, dispatch);\n    syncPreviewBoard();\n    syncReachBoards();\n    syncBoardRow();\n    cmds.forEach((cmd) => {\n      void runCmd(cmd);\n    });\n  };\n\n  let lastActiveGameId: string | null = null;\n\n  const syncPreviewBoard = (): void => {\n    const active = getActiveGame(model);\n    if (!active) {\n      resources.previewBoard?.destroy();\n      resources.previewBoard = null;\n      resources.previewMode = null;\n      resources.analysisGame = null;\n      lastActiveGameId = null;\n      return;\n    }\n    const mode = model.workflow.tag === \"ANALYSIS\" ? \"analysis\" : \"preview\";\n    const analysisFen =\n      model.workflow.tag === \"ANALYSIS\" ? getAnalysisNodeFen(model, active.id) : null;\n    const boardFen = analysisFen ?? active.fen;\n    const gameChanged = lastActiveGameId !== active.id;\n    lastActiveGameId = active.id;\n    if (!resources.previewBoard || resources.previewMode !== mode || gameChanged) {\n      resources.previewBoard?.destroy();\n      resources.previewBoard = null;\n      const onDrop =\n        mode === \"analysis\"\n          ? (source: string, target: string) => {\n              if (!resources.analysisGame) return \"snapback\";\n              const move = resources.analysisGame.move({\n                from: source,\n                to: target,\n                promotion: \"q\",\n              });\n              if (!move) return \"snapback\";\n              dispatch({ tag: \"AnalysisMoveMade\", san: asSan(move.san), fen: asFenFull(resources.analysisGame.fen()) });\n              return undefined;\n            }\n          : undefined;\n      const onSnapEnd =\n        mode === \"analysis\"\n          ? () => {\n              if (!resources.analysisGame || !resources.previewBoard) return;\n              resources.previewBoard.position(resources.analysisGame.fen());\n            }\n          : undefined;\n      resources.previewBoard = createBoard(\"active-board\", {\n        position: String(boardFen),\n        draggable: true,\n        showNotation: mode === \"analysis\",\n        pieceTheme: \"/static/vendor/img/chesspieces/wikipedia/{piece}.png\",\n        dropOffBoard: \"trash\",\n        sparePieces: false,\n        onDrop,\n        onSnapEnd,\n      });\n      resources.previewMode = mode;\n    } else if (mode === \"analysis\") {\n      // Only sync position in analysis mode - in preview mode, let user edit freely\n      resources.previewBoard?.position(String(boardFen), false);\n    }\n    resources.analysisGame = mode === \"analysis\" && analysisFen ? new Chess(analysisFen) : null;\n  };\n\n  const syncReachBoards = (): void => {\n    if (model.workflow.tag !== \"REACHING\") {\n      resources.reachGame = null;\n      return;\n    }\n    if (!resources.reachGame || resources.reachGame.fen() !== String(model.workflow.session.currentFen)) {\n      resources.reachGame = new Chess(model.workflow.session.currentFen);\n    }\n    resources.reachBoards.entry?.position(String(model.workflow.session.currentFen));\n  };\n\n  const syncBoardRow = (): void => {\n    const workflow = model.workflow;\n    const modeKey = workflow.tag;\n\n    // Destroy boards if mode changes or workflow closes\n    if (modeKey === \"NO_PDF\" || modeKey === \"VIEWING\") {\n      if (resources.boardRow.currentMode !== null) {\n        resources.boardRow.before?.destroy();\n        resources.boardRow.now?.destroy();\n        resources.boardRow.after?.destroy();\n        resources.boardRow = { before: null, now: null, after: null, nowGame: null, currentMode: null };\n      }\n      return;\n    }\n\n    // Mode changed - rebuild boards\n    if (resources.boardRow.currentMode !== modeKey) {\n      resources.boardRow.before?.destroy();\n      resources.boardRow.now?.destroy();\n      resources.boardRow.after?.destroy();\n      resources.boardRow.nowGame = null;\n\n      const pieceTheme = \"/static/vendor/img/chesspieces/wikipedia/{piece}.png\";\n\n      switch (workflow.tag) {\n        case \"PENDING_CONFIRM\": {\n          // Single board showing detected position\n          resources.boardRow.now = createBoard(\"now-board\", {\n            position: String(workflow.pending.targetFen),\n            draggable: false,\n            showNotation: false,\n            pieceTheme,\n          });\n          resources.boardRow.before = null;\n          resources.boardRow.after = null;\n          break;\n        }\n\n        case \"MATCH_EXISTING\": {\n          // Before (selected game) + Now (detected)\n          const selectedId = workflow.selected;\n          const selectedGame = selectedId ? model.games.find(g => g.id === selectedId) : null;\n          if (selectedGame) {\n            resources.boardRow.before = createBoard(\"before-board\", {\n              position: String(selectedGame.fen),\n              draggable: false,\n              showNotation: false,\n              pieceTheme,\n            });\n          }\n          resources.boardRow.now = createBoard(\"now-board\", {\n            position: String(workflow.pending.targetFen),\n            draggable: false,\n            showNotation: false,\n            pieceTheme,\n          });\n          resources.boardRow.after = null;\n          break;\n        }\n\n        case \"REACHING\": {\n          const session = workflow.session;\n          resources.boardRow.nowGame = new Chess(session.startFen);\n\n          // Before (start position)\n          resources.boardRow.before = createBoard(\"before-board\", {\n            position: String(session.startFen).split(\" \")[0],\n            draggable: false,\n            showNotation: false,\n            pieceTheme,\n          });\n\n          // Now (interactive entry board)\n          const onDragStart = (_source: string, piece: string) => {\n            if (!resources.boardRow.nowGame) return false;\n            if (resources.boardRow.nowGame.game_over()) return false;\n            const turn = resources.boardRow.nowGame.turn();\n            if ((turn === \"w\" && piece.startsWith(\"b\")) || (turn === \"b\" && piece.startsWith(\"w\"))) {\n              return false;\n            }\n            return true;\n          };\n          const onDrop = (source: string, target: string) => {\n            if (!resources.boardRow.nowGame) return \"snapback\";\n            const move = resources.boardRow.nowGame.move({ from: source, to: target, promotion: \"q\" });\n            if (!move) return \"snapback\";\n            dispatch({ tag: \"ReachMoveMade\", san: asSan(move.san), fen: asFenFull(resources.boardRow.nowGame.fen()) });\n            return undefined;\n          };\n          const onSnapEnd = () => {\n            if (!resources.boardRow.nowGame || !resources.boardRow.now) return;\n            resources.boardRow.now.position(resources.boardRow.nowGame.fen());\n          };\n\n          resources.boardRow.now = createBoard(\"now-board\", {\n            position: String(session.startFen).split(\" \")[0],\n            draggable: true,\n            showNotation: true,\n            pieceTheme,\n            onDragStart,\n            onDrop,\n            onSnapEnd,\n          });\n\n          // After (target position)\n          resources.boardRow.after = createBoard(\"after-board\", {\n            position: String(session.targetFen),\n            draggable: false,\n            showNotation: false,\n            pieceTheme,\n          });\n          break;\n        }\n\n        case \"ANALYSIS\": {\n          const game = model.games.find(g => g.id === workflow.activeGameId);\n          const tree = model.analyses[workflow.activeGameId];\n          let currentFen = game?.fen ?? \"start\";\n\n          // Get FEN at current cursor position\n          if (tree && workflow.cursor.length > 0) {\n            let node = tree.root;\n            for (const san of workflow.cursor) {\n              const child = node.children.find(c => c.san === san);\n              if (child) {\n                node = child;\n              } else {\n                break;\n              }\n            }\n            currentFen = node.fen.split(\" \")[0];\n          }\n\n          resources.boardRow.nowGame = new Chess(currentFen);\n\n          const onDrop = (source: string, target: string) => {\n            if (!resources.boardRow.nowGame) return \"snapback\";\n            const move = resources.boardRow.nowGame.move({ from: source, to: target, promotion: \"q\" });\n            if (!move) return \"snapback\";\n            dispatch({ tag: \"AnalysisMoveMade\", san: asSan(move.san), fen: asFenFull(resources.boardRow.nowGame.fen()) });\n            return undefined;\n          };\n          const onSnapEnd = () => {\n            if (!resources.boardRow.nowGame || !resources.boardRow.now) return;\n            resources.boardRow.now.position(resources.boardRow.nowGame.fen());\n          };\n\n          resources.boardRow.now = createBoard(\"now-board\", {\n            position: currentFen,\n            draggable: true,\n            showNotation: true,\n            pieceTheme,\n            onDrop,\n            onSnapEnd,\n          });\n          resources.boardRow.before = null;\n          resources.boardRow.after = null;\n          break;\n        }\n      }\n\n      resources.boardRow.currentMode = modeKey;\n\n      // Trigger resize after a short delay to ensure DOM is ready\n      setTimeout(() => {\n        resources.boardRow.before?.resize();\n        resources.boardRow.now?.resize();\n        resources.boardRow.after?.resize();\n      }, 50);\n      return;\n    }\n\n    // Mode hasn't changed - just update positions if needed\n    switch (workflow.tag) {\n      case \"REACHING\": {\n        const session = workflow.session;\n        // Sync now board with current game state\n        if (!resources.boardRow.nowGame || resources.boardRow.nowGame.fen() !== String(session.currentFen)) {\n          resources.boardRow.nowGame = new Chess(session.currentFen);\n        }\n        resources.boardRow.now?.position(String(session.currentFen));\n        break;\n      }\n\n      case \"ANALYSIS\": {\n        const tree = model.analyses[workflow.activeGameId];\n        const game = model.games.find(g => g.id === workflow.activeGameId);\n        let currentFen = game?.fen ?? \"start\";\n\n        if (tree && workflow.cursor.length > 0) {\n          let node = tree.root;\n          for (const san of workflow.cursor) {\n            const child = node.children.find(c => c.san === san);\n            if (child) {\n              node = child;\n            } else {\n              break;\n            }\n          }\n          currentFen = node.fen;\n        }\n\n        resources.boardRow.now?.position(currentFen.split(\" \")[0]);\n        if (resources.boardRow.nowGame) {\n          resources.boardRow.nowGame = new Chess(currentFen);\n        }\n        break;\n      }\n\n      case \"MATCH_EXISTING\": {\n        // Update before board if selection changed\n        const selectedId = workflow.selected;\n        const selectedGame = selectedId ? model.games.find(g => g.id === selectedId) : null;\n        if (selectedGame && resources.boardRow.before) {\n          resources.boardRow.before.position(String(selectedGame.fen));\n        }\n        break;\n      }\n    }\n  };\n\n  const runCmd = async (cmd: Cmd): Promise<void> => {\n    switch (cmd.tag) {\n      case \"PDF_LOAD_FILE\": {\n        const contentHash = await hashFile(cmd.file);\n        const hash = asContentHash(contentHash);\n        const check = await checkPdf(hash);\n        if (check.ok && check.value.exists) {\n          const info = check.value.info;\n          const loaded = await loadPdf(info.pdfId);\n          if (!loaded.ok) {\n            dispatch({ tag: \"Error\", scope: \"pdf\", message: loaded.error });\n            return;\n          }\n          resources.pdf.doc = loaded.value;\n          dispatch({\n            tag: \"PdfOpened\",\n            pdfId: info.pdfId,\n            pages: info.pages,\n            filename: cmd.file.name,\n            contentHash: info.contentHash,\n          });\n          return;\n        }\n        const uploaded = await uploadPdf(cmd.file, hash);\n        if (!uploaded.ok) {\n          dispatch({ tag: \"Error\", scope: \"upload\", message: uploaded.error });\n          return;\n        }\n        const loaded = await loadPdf(uploaded.value.pdfId);\n        if (!loaded.ok) {\n          dispatch({ tag: \"Error\", scope: \"pdf\", message: loaded.error });\n          return;\n        }\n        resources.pdf.doc = loaded.value;\n        dispatch({\n          tag: \"PdfOpened\",\n          pdfId: uploaded.value.pdfId,\n          pages: uploaded.value.pages,\n          filename: uploaded.value.filename,\n          contentHash: uploaded.value.contentHash,\n        });\n        return;\n      }\n      case \"PDF_LOAD_BY_ID\": {\n        const loaded = await loadPdf(cmd.pdfId);\n        if (!loaded.ok) {\n          dispatch({ tag: \"Error\", scope: \"pdf\", message: loaded.error });\n          return;\n        }\n        resources.pdf.doc = loaded.value;\n        return;\n      }\n      case \"PDF_RENDER_PAGE\": {\n        const result = await renderPage(\n          resources.pdf,\n          { canvas: els.pdfCanvas, overlay: els.detectionOverlay, viewportContainer: els.pdfViewport },\n          cmd.page,\n          cmd.scale,\n          model.pdf.initialScaleSet,\n        );\n        if (result.ok) {\n          dispatch({\n            tag: \"PageRendered\",\n            page: cmd.page,\n            scale: result.value.scale,\n            initialScaleSet: result.value.initialScaleSet,\n          });\n        } else {\n          dispatch({ tag: \"Error\", scope: \"render\", message: result.error });\n        }\n        return;\n      }\n      case \"PDF_CANCEL_RENDER\":\n        if (resources.pdf.renderTask) {\n          try {\n            resources.pdf.renderTask.cancel();\n          } catch {\n            // ignore\n          }\n          resources.pdf.renderTask = null;\n        }\n        return;\n      case \"API_CHECK_PDF\":\n        await checkPdf(cmd.contentHash);\n        return;\n      case \"API_UPLOAD_PDF\":\n        await uploadPdf(cmd.file, cmd.contentHash);\n        return;\n      case \"API_DETECT_DIAGRAMS\": {\n        const result = await detectDiagrams(cmd.pdfId, cmd.page as number);\n        if (result.ok) {\n          dispatch({ tag: \"DiagramsDetected\", page: toPageNum(cmd.page), diagrams: result.value });\n        } else {\n          dispatch({ tag: \"Error\", scope: \"detect\", message: result.error });\n        }\n        return;\n      }\n      case \"API_RECOGNIZE_REGION\": {\n        const result = await recognizeRegion(cmd.pdfId, cmd.page as number, cmd.bbox);\n        if (result.ok) {\n          dispatch({\n            tag: \"Recognized\",\n            page: toPageNum(cmd.page),\n            bbox: cmd.bbox,\n            placement: result.value.placement,\n            confidence: result.value.confidence,\n            gameId: asGameId(`g${cmd.page}_${Date.now()}`),\n          });\n        } else {\n          dispatch({ tag: \"RecognitionFailed\", message: result.error });\n        }\n        return;\n      }\n      case \"API_EXTRACT_MOVES\": {\n        const result = await extractMoves(cmd.pdfId, cmd.page as number, cmd.bbox);\n        if (!result.ok) {\n          dispatch({ tag: \"ExtractMovesFailed\", message: result.error });\n          return;\n        }\n        const bestText = result.value.pdfText.trim().length > 0 ? result.value.pdfText : result.value.ocrText;\n        dispatch({\n          tag: \"TextOverlayUpdated\",\n          text: bestText.trim() || \"No text detected\",\n          visible: true,\n        });\n        dispatch({ tag: \"OcrStatusUpdated\", text: \"Text extracted\" });\n        return;\n      }\n      case \"STUDY_LOAD\": {\n        const result = await loadStudy(cmd.pdfId);\n        if (result.ok) {\n          dispatch({ tag: \"StudyLoaded\", study: result.value });\n        } else {\n          dispatch({ tag: \"Error\", scope: \"study\", message: result.error });\n        }\n        return;\n      }\n      case \"STUDY_SAVE\": {\n        const study = buildStudy(model);\n        const result = await saveStudy(cmd.pdfId, study);\n        if (result.ok) {\n          dispatch({ tag: \"StudySaved\" });\n        } else {\n          dispatch({ tag: \"Error\", scope: \"study\", message: result.error });\n        }\n        return;\n      }\n      case \"STUDY_DELETE\":\n        return;\n      case \"BOARD_STATUS_POLL_START\": {\n        if (resources.boardStatusTimer) {\n          window.clearInterval(resources.boardStatusTimer);\n        }\n        const poll = async () => {\n          const status = await fetchStatus();\n          if (status.ok) {\n            dispatch({\n              tag: \"BoardStatusUpdated\",\n              available: status.value.available,\n              connected: status.value.connected,\n            });\n          }\n        };\n        void poll();\n        const timer = window.setInterval(poll, cmd.everyMs);\n        resources.boardStatusTimer = timer;\n        return;\n      }\n      case \"BOARD_STATUS_POLL_STOP\":\n        if (resources.boardStatusTimer) {\n          window.clearInterval(resources.boardStatusTimer);\n          resources.boardStatusTimer = null;\n        }\n        return;\n      case \"CHESSNUT_SET_FEN\": {\n        await setFen(cmd.fen, cmd.force);\n        return;\n      }\n      case \"CHESSNUT_POLL_START\": {\n        if (resources.chessnutPollTimer) {\n          window.clearInterval(resources.chessnutPollTimer);\n        }\n        const timer = window.setInterval(async () => {\n          const result = await fetchFen();\n          if (result.ok) {\n            dispatch({ tag: \"BoardFenUpdated\", fen: result.value });\n          }\n        }, cmd.everyMs);\n        resources.chessnutPollTimer = timer;\n        return;\n      }\n      case \"CHESSNUT_POLL_STOP\":\n        if (resources.chessnutPollTimer) {\n          window.clearInterval(resources.chessnutPollTimer);\n          resources.chessnutPollTimer = null;\n        }\n        return;\n      case \"REACH_SYNC_BOARD\":\n        await setFen(cmd.fen, true);\n        return;\n      case \"REACH_HANDLE_PHYSICAL\":\n        return;\n      case \"ENGINE_START\": {\n        if (!resources.stockfish) {\n          resources.stockfish = createStockfish((info) =>\n            dispatch({ tag: \"EngineInfo\", evalText: info.evalText, pv: info.pv }),\n          );\n        }\n        if (resources.stockfish) {\n          startEngine(resources.stockfish);\n          dispatch({ tag: \"EngineStarted\" });\n        }\n        return;\n      }\n      case \"ENGINE_STOP\":\n        if (resources.stockfish) {\n          stopEngine(resources.stockfish);\n          dispatch({ tag: \"EngineStopped\" });\n        }\n        return;\n      case \"ENGINE_ANALYZE\":\n        if (resources.stockfish) {\n          analyze(resources.stockfish, cmd.fen, cmd.depth);\n        }\n        return;\n      case \"ANALYSIS_SYNC\":\n        if (resources.stockfish && model.engine.running) {\n          analyze(resources.stockfish, cmd.fen, 16);\n        }\n        return;\n      case \"CLIPBOARD_WRITE\":\n        try {\n          await navigator.clipboard.writeText(cmd.text);\n        } catch {\n          dispatch({ tag: \"Error\", scope: \"clipboard\", message: \"Clipboard unavailable\" });\n        }\n        return;\n      case \"CHESSBOARD_READ_PREVIEW\":\n        if (resources.previewBoard) {\n          const placement = getBoardFen(resources.previewBoard);\n          dispatch({ tag: \"PiecesConfirmed\", placement });\n        }\n        return;\n      // OPEN_REACH_MODAL and CLOSE_REACH_MODAL removed - board row handles reach mode now\n      case \"REACH_SET_MOVES\":\n        dispatch({ tag: \"ReachTargetResolved\", moves: cmd.moves, finalFen: cmd.finalFen, turn: null });\n        return;\n      case \"SCHEDULE_SAVE\":\n        if (resources.saveTimer) {\n          window.clearTimeout(resources.saveTimer);\n        }\n        resources.saveTimer = window.setTimeout(() => {\n          if (model.pdf.id) {\n            dispatch({ tag: \"Status\", message: \"Saving study...\" });\n            void runCmd({ tag: \"STUDY_SAVE\", pdfId: model.pdf.id });\n          }\n        }, cmd.delayMs);\n        return;\n      case \"NO_OP\":\n        return;\n      default:\n        return;\n    }\n  };\n\n  bindEvents(dispatch, getModel);\n  setupPiecePalettes(\n    dispatch,\n    () => resources.previewBoard,\n    () => model.workflow.tag !== \"ANALYSIS\",\n  );\n  bindManualSelection(dispatch, getModel);\n  render(model, dispatch);\n  syncPreviewBoard();\n  syncReachBoards();\n  syncBoardRow();\n  window.addEventListener(\"beforeunload\", (event) => {\n    if (model.isDirty && model.pdf.id) {\n      void runCmd({ tag: \"STUDY_SAVE\", pdfId: model.pdf.id });\n      event.preventDefault();\n      event.returnValue = \"\";\n    }\n  });\n  return { dispatch, getModel };\n};\n", "import { initialModel } from \"./core/model\";\nimport { createRuntime } from \"./core/runtime\";\n\npdfjsLib.GlobalWorkerOptions.workerSrc = \"/static/vendor/js/pdf.worker.min.js\";\n\nwindow.addEventListener(\"DOMContentLoaded\", () => {\n  createRuntime(initialModel);\n});\n"],
  "mappings": "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",
  "names": ["filtered", "nextModel", "tree", "rect", "bbox", "isRecord", "pieceTheme", "loaded"]
}
